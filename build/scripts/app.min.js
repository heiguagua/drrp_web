"use strict";var app=angular.module("app",["Config","ui.router","ui.bootstrap","treeControl","isteven-multi-select","Welcome","Login","Main","Dashboard","Admin","Admin.User","Admin.Department","Admin.DepResource","Department","DataQuota","DataQuotaList","DataQuotaDetail","Department.Inventory","Department.InventoryDetail","Department.InventoryUpload","Department.Audit","Department.Requirement","DepartmentShare"]);app.config(["$stateProvider","$urlRouterProvider","$httpProvider","$provide",function(e,t,a,n){a.interceptors.push(["$q",function(e){return{request:function(e){return e.withCredentials=!0,e},requestError:function(e){return e},response:function(t){return e.when(t,function(e){t.data&&"object"==typeof t.data&&300===e.data.head.status&&(sessionStorage.message="登录超时，请重新登录！",window.location.href="./#/login")}),t},responseError:function(e){return e}}}]),t.otherwise("/welcome"),e.state("welcome",{url:"/welcome?type?titleName",templateUrl:"views/common/welcome.html",controller:"Welcome.Controller.Main"}).state("login",{url:"/login",templateUrl:"views/common/login.html",controller:"Login.Controller.Main"}).state("main",{url:"/main",templateUrl:"views/common/main.html",controller:"Main.Controller.Main"}).state("main.dashboard",{url:"/dashboard",templateUrl:"views/common/dashboard.html",controller:"Dashboard.Controller.Main"}).state("main.admin",{url:"/admin",templateUrl:"views/admin/main.html",controller:"Admin.Controller.Main"}).state("main.admin.department",{url:"/department",templateUrl:"views/admin/department.html",controller:"Admin.Department.Controller.Main"}).state("main.admin.dep-resource",{url:"/dep-resource",templateUrl:"views/admin/dep-resource.html",controller:"Admin.DepResource.Controller.Main"}).state("main.admin.user",{url:"/user",templateUrl:"views/admin/user.html",controller:"Admin.User.Controller.Main"}).state("main.data-quota",{url:"/data-quota/:type/:titleName",templateUrl:"views/data-quota/main.html",controller:"DataQuota.Controller.Main"}).state("main.data-quota.list",{url:"/list/:resource_dep_id/:dep_name/:type/:titleName",templateUrl:"views/data-quota/list0.html",controller:"DataQuotaList.Controller.Main"}).state("main.data-quota.detail",{url:"/detail/:resource_id",templateUrl:"views/data-quota/detail0.html",controller:"DataQuotaDetail.Controller.Main"}).state("main.department",{url:"/department",templateUrl:"views/department/main.html"}).state("main.department.summary",{url:"/summary",cache:"false",reload:!0,templateUrl:"views/department/summary.html",controller:"Department.Controller.Main"}).state("main.department.inventory",{url:"/inventory",cache:"false",templateUrl:"views/department/inventory.html",controller:"Department.Inventory.Controller.Main"}).state("main.department.inventory.publish",{url:"/publish",templateUrl:"views/department/inventory-publish.html",controller:"Department.Inventory.Controller.publish"}).state("main.department.inventory.update",{url:"/update/:item",templateUrl:"views/department/inventory-update.html",controller:"Department.Inventory.Controller.publish"}).state("main.department.inventory.upload",{url:"/upload?ID",cache:"false",templateUrl:"views/department/inventory-upload.html",controller:"Department.InventoryUpload.Controller"}).state("main.department.inventory.uploadExampleData",{url:"/uploadExamples?ID",cache:"false",templateUrl:"views/department/inventory-upload-examples.html",controller:"Department.InventoryUploadExamples.Controller"}).state("main.department.detail",{url:"/detail/:item",cache:"false",templateUrl:"views/department/inventory-detail.html",controller:"Department.InventoryDetail.Controller"}).state("main.department.share",{url:"/share",templateUrl:"views/department/share.html",controller:"DepartmentShare.Controller.Main"}).state("main.department.share.detail",{url:"/detail/:item",templateUrl:"views/department/share-detail.html",controller:"DepartmentShare.Controller.detail"}).state("main.department.requirementConfirm",{url:"/requirement-confirm",templateUrl:"views/department/requirement-confirm.html",controller:"Department.Requirement.Controller.confirm"}).state("main.department.requirement",{url:"/requirement",templateUrl:"views/department/requirement.html",controller:"Department.Requirement.Controller.Main"}).state("main.department.requirement.publish",{url:"/publish",templateUrl:"views/department/requirement-publish.html"}).state("main.department.requirementConfirm.detail",{url:"/detail?ID",templateUrl:"views/department/requirement-detail.html",controller:"Department.Requirement.Controller.detail"}).state("main.department.requirement.detail",{url:"/detail?ID",templateUrl:"views/department/requirement-detail.html",controller:"Department.Requirement.Controller.detail"}).state("main.department.audit",{url:"/audit",cache:"false",templateUrl:"views/department/audit.html",controller:"Department.Audit.Controller.Main"}).state("main.department.auditinfo",{url:"/auditinfo/:AUDITID/:RESOURCEID/:APPLYDEP/:APPLYTIME",templateUrl:"views/department/audit-info.html",controller:"Department.Audit.Controller.info"}).state("main.department.auditdetail",{url:"/auditdetail/:AUDITSTATUS/:RESOURCEID/:APPLYTIME/:APPLYDEP/:OPINION",templateUrl:"views/department/audit-detail.html",controller:"Department.Audit.Controller.detail"})}]),app.run(["$rootScope",function(e){e.$on("$stateChangeStart",function(e,t,a,n,o){"welcome"!==t.name&&"login"!==t.name&&(sessionStorage.token||(window.location.href="./#/login"))})}]);var Config=angular.module("Config",[]);Config.constant("API",{path:"http://172.16.1.78:8080/api"});var AdminDepartment=angular.module("Admin.Department",["ui.router"]);AdminDepartment.controller("Admin.Department.Controller.Main",["$rootScope","$scope","$stateParams","AdminDepartment.Service.Http","AdminDepartment.Service.Component","$uibModal","$state",function(e,t,a,n,o,r,i){function s(e){n.getDepartmentList(e).then(function(e){t.AdminDepartments=e.data.body})}function l(){n.getDepTotal().then(function(e){t.depTotal=e.data.body[0].number,t.Paging.totalItems=t.depTotal})}t.Modal={},t.previousDepNames=[],t.areaNames=[],t.themeNames=[],t.Paging={},t.Paging.currentPage=1,t.Paging.maxSize=5,t.Paging.itemsPerPage=10;var c={};c.limit=10,c.skip=0,t.Paging.pageChanged=function(){c.skip=(t.Paging.currentPage-1)*c.limit,c.sysdepname=t.dep_name,s(c)},s(c),l(),n.getDepartmentList().then(function(e){t.AllDepartments=e.data.body}),n.getSysDict({dict_category:"7"}).then(function(e){t.types=e.data.body}),n.getSysDict({dict_category:"8"}).then(function(e){t.ocupations=e.data.body}),n.getSysDict({dict_category:"9"}).then(function(e){t.areaNames=e.data.body}),n.getSysDict({dict_category:"17"}).then(function(e){t.themeNames=e.data.body}),t.placeholder={},t.placeholder.dep_sn="必填",t.placeholder.order_by="必填",t.placeholder.dep_name="必填",t.placeholder.dep_short_name="必填",t.placeholder.dep_en_name="必填",t.placeholder.contacts="必填",t.placeholder.contact_phone="必填",t.addDepartmentModal=function(){t.Modal={},t.department={},t.department.dep_en_name="anquanting.png",t.department.parent_id="0",t.department.area_code="2c2934b2-10df-11e6-9b44-507b9d1b58bb",t.department.dep_type="aa7772bb-10de-11e6-9b44-507b9d1b58bb",t.department.role_type="d7f3a0df-10de-11e6-9b44-507b9d1b58bb",t.department.theme="7751ba0f-3c4f-11e6-be2b-507b9d1b58bb";var e=o.popModal(t,"添加","add-department-modal");e.opened.then(function(){t.Modal.TypeArea=function(){if("0"!=t.department.parent_id){var e=_.findIndex(t.AllDepartments,function(e){return e.id==t.department.parent_id});t.department1=t.AllDepartments[e]}},t.Modal.validDepName=function(e){t.validDepName=!1,t.placeholder.dep_name="必填",n.getDepartmentList().then(function(a){for(var n=a.data.body,o=0;o<n.length;o++)n[o].dep_name===e&&(t.validDepName=!0,t.placeholder.dep_name="该部门已存在,请重新输入",t.department.dep_name="")})},t.Modal.validPhone=function(){t.placeholder.contact_phone="必填",t.validPhone=!1;var e=/^(\d{3,4}-)?\d{7,8}$|(^1[3|4|5|7|8]\d{9}$)/;e.test(t.department.contact_phone)||null==t.department.contact_phone||(t.validPhone=!0,t.placeholder.contact_phone="电话格式不对",t.department.contact_phone="")}}),e.result.then(function(){n.saveDepartment(t.department).then(function(e){200==e.data.head.status?alert("添加成功"):alert("添加失败"),c.limit=10,c.skip=0,t.Paging.currentPage=1,s(c),l()})})},t.updateDepartment=function(e){t.department=e,t.department.parent_id="0",t.department.area_code="2c2934b2-10df-11e6-9b44-507b9d1b58bb",t.department.dep_type="aa7772bb-10de-11e6-9b44-507b9d1b58bb",t.department.role_type="d7f3a0df-10de-11e6-9b44-507b9d1b58bb",t.department.theme="7751ba0f-3c4f-11e6-be2b-507b9d1b58bb",t.department.dep_en_name="anquanting.png",_.remove(t.AllDepartments,function(t){return t.dep_name==e.dep_name});var a=o.popModal(t,"修改","add-department-modal");a.opened.then(function(){t.Modal.TypeArea=function(){if("0"!=t.department.parent_id){var e=_.findIndex(t.AllDepartments,function(e){return e.id==t.department.parent_id});t.department1=t.AllDepartments[e]}},t.Modal.validDepName=function(e){t.validDepName=!1,t.placeholder.dep_name="必填",n.getDepartmentList().then(function(a){for(var n=a.data.body,o=0;o<n.length;o++)n[o].dep_name===e&&(t.validDepName=!0,t.placeholder.dep_name="该部门已存在,请重新输入",t.department.dep_name="")})},t.Modal.validPhone=function(){t.placeholder.contact_phone="必填",t.validPhone=!1;var e=/^(\d{3,4}-)?\d{7,8}$|(^1[3|4|5|7|8]\d{9}$)/;e.test(t.department.contact_phone)||null==t.department.contact_phone||(t.validPhone=!0,t.placeholder.contact_phone="电话格式不对",t.department.contact_phone="")}}),a.result.then(function(){n.updateDepartment(t.department).then(function(e){c.limit=10,c.skip=0,t.Paging.currentPage=1,200==e.data.head.status?alert("修改成功"):alert("修改失败"),s(c)})})},t.deleteDepartment=function(e){var a=confirm("确定要删除吗？");a&&n.deleteDepartment(e).then(function(e){c.limit=10,c.skip=0,t.Paging.currentPage=1,200==e.data.head.status?alert("删除成功"):alert("删除失败！"),i.go("main.admin.department",{},{reload:!0})})},t.searchDepartment=function(){c.limit=10,c.skip=0,c.sysdepname=t.dep_name,null==t.dep_name?(l(),s(c)):n.getDepartmentList(c).then(function(e){e.data.head.total>=1?(t.AdminDepartments=e.data.body,t.depTotal=e.data.head.total,t.Paging.totalItems=t.depTotal):(alert("系统没有查到'"+t.dep_name+"'这个部门，请重新输入"),t.dep_name="",i.go("main.admin.department",{},{reload:!0}))})}}]),AdminDepartment.factory("AdminDepartment.Service.Http",["$http","API",function(e,t){function a(t){return e.get(l+"/sys_dep",{params:t})}function n(){return e.get(l+"/sys_dep/count")}function o(t){return e.post(l+"/sys_dep",{data:t})}function r(t){return e.get(l+"/sys_dict",{params:t})}function i(t){return e.put(l+"/sys_dep",{data:t})}function s(t){return e["delete"](l+"/sys_dep",{data:{id:t.id}})}var l=t.path;return{getDepartmentList:a,getDepTotal:n,saveDepartment:o,getSysDict:r,updateDepartment:i,deleteDepartment:s}}]),AdminDepartment.service("AdminDepartment.Service.Component",["$uibModal","$state",function(e,t){function a(e,t){e.Alerts=[{type:t.type,message:t.message,timeout:1200}],e.CloseAlert=function(t){e.Alerts.splice(t,1)}}function n(a,n,o){a.Modal.type=n;var r=e.open({animation:!0,backdrop:"static",templateUrl:o+".html",scope:a,size:"md"});return a.Modal.confirm=function(e){e&&r.close(a.Modal)},a.Modal.cancel=function(){r.dismiss(),t.go("main.admin.department",{},{reload:!0})},r}return{popAlert:a,popModal:n}}]);var AdminDepResource=angular.module("Admin.DepResource",["ui.router"]);AdminDepResource.controller("Admin.DepResource.Controller.Main",["$scope","AdminDepResource.Service.Http","$state",function(e,t,a){function n(){t.getDepCount().then(function(t){e.depTotal=t.data.body[0].number,e.Paging.totalItems=e.depTotal})}function o(a){t.getDepRelRescount(a).then(function(t){e.depRecouces=t.data.body})}e.Paging={},e.Paging.currentPage=1,e.Paging.maxSize=5,e.Paging.itemsPerPage=10;var r={};r.limit=10,r.skip=0,e.Paging.pageChanged=function(){r.skip=(e.Paging.currentPage-1)*r.limit,r.dep_name=e.query.dep_name,o(r)},n(),o(r)}]),AdminDepResource.factory("AdminDepResource.Service.Http",["$http","API",function(e,t){function a(){return e.get(o+"/sys_dep/count")}function n(t){return e.get(o+"/deprelrescount",{params:t})}var o=t.path;return{getDepRelRescount:n,getDepCount:a}}]);var Admin=angular.module("Admin",["ui.router","ngCookies"]);Admin.controller("Admin.Controller.Main",["$cookies","$scope","$stateParams",function(e,t,a){var n=JSON.parse(e.get("User"));"e147f177-1e83-11e6-ac02-507b9d1b58bb"===n.id?t.titleName="用户/部门管理":t.titleName="用户管理"}]);var AdminUser=angular.module("Admin.User",["ui.router","ngCookies"]);AdminUser.controller("Admin.User.Controller.Main",["$cookies","$scope","$q","$stateParams","AdminUser.Service.Http","AdminUser.Service.Component","$uibModal","$state",function(e,t,a,n,o,r,i,s){function l(e){o.getUserList(e).then(function(e){t.users=e.data.body})}function c(){o.getUserTotal({dep_id:d}).then(function(e){if("e147f177-1e83-11e6-ac02-507b9d1b58bb"===u.id){var a=e.data.body[0].number-1;t.UserTotal=a}else t.UserTotal=e.data.body[0].number;t.Paging.totalItems=t.UserTotal})}var u=JSON.parse(e.get("User")),d="e147f177-1e83-11e6-ac02-507b9d1b58bb"===u.id?null:u.dep_id,m="e147f177-1e83-11e6-ac02-507b9d1b58bb"===u.id?null:u.dep_name;t.Paging={},t.Paging.currentPage=1,t.Paging.maxSize=5,t.Paging.itemsPerPage=10;var p={};p.limit=10,p.skip=0,p.dep_id="e147f177-1e83-11e6-ac02-507b9d1b58bb"===u.id?null:d,t.Paging.pageChanged=function(){p.skip=(t.Paging.currentPage-1)*p.limit,p.sysusername=t.username,l(p)},t.Modal={},t.deptList=[],c(),l(p),o.getDepartmentList({dep_name:m}).then(function(e){t.deptList=e.data.body}),t.placeholder={},t.placeholder.name="必填",t.placeholder.password="必填",t.placeholder.password1="必填",t.placeholder.personName="必填",t.placeholder.organization="必填",t.placeholder.organization_code="必填，根据机构名称自动生成",t.placeholder.phone="必填",t.placeholder.email="必填",t.placeholder.remark="",t.addUserModal=function(){t.Modal={},t.sysUser={},t.sysUser.remark="";var e=r.popModal(t,"添加","add-user-modal");e.opened.then(function(){t.Modal.validUser=function(e){t.placeholder.name="必填",t.validUser=!1,o.getUserList({dep_id:d}).then(function(a){for(var n=a.data.body,o=0;o<n.length;o++)n[o].username===e&&(t.validUser=!0,t.placeholder.name="用户名已存在,请重新输入",t.sysUser.username="")})},t.Modal.organization=function(){t.placeholder.organization="必填",t.placeholder.organization_code="必填，根据机构名称自动生成",t.organization=!1;var e=t.sysUser.organization;e&&o.getUserOrganizationCode({organization:e}).then(function(e){var a=e.data.body[0].organization_code.split(",");0==a[1]?t.sysUser.organization_code=a[0]:(t.placeholder.organization="机构名称已存在，请重新输入",t.organization=!0,t.sysUser.organization="")})},t.Modal.validPword=function(){t.placeholder.password1="必填",t.validPword=!1,t.sysUser.password!=t.sysUser.password1&&null!=t.sysUser.password1&&(t.validPword=!0,t.placeholder.password1="两次输入的密码不同,请重新输入",t.sysUser.password1="")},t.Modal.validPhone=function(){t.placeholder.phone="必填",t.validPhone=!1;var e=/^(\d{3,4}-)?\d{7,8}$|(^1[3|4|5|7|8]\d{9}$)/;e.test(t.sysUser.phone)||null==t.sysUser.phone||(t.validPhone=!0,t.placeholder.phone="电话格式不对",t.sysUser.phone="")},t.Modal.validEmail=function(e){t.placeholder.email="必填",t.validEmail=!1,e&&(t.validEmail=!0,t.placeholder.email="邮箱格式不对",t.sysUser.email="")}}),e.result.then(function(){o.saveUser(t.sysUser).then(function(e){200==e.data.head.status?alert("添加成功"):alert("保存数据库失败"),p.limit=10,p.skip=0,t.Paging.currentPage=1,l(p),c()})})},t.updateUser=function(e){t.sysUser=e,t.sysUser.password1=0,t.sysUser.password=0,t.sysUser.remark=e.remark?e.remark:"";var a=r.popModal(t,"修改","add-user-modal");a.opened.then(function(){t.Modal.validUser=function(e){t.placeholder.name="必填",t.validUser=!1,o.getUserList({dep_id:d}).then(function(a){for(var n=a.data.body,o=0;o<n.length;o++)n[o].username===e&&(t.validUser=!0,t.placeholder.name="用户名已存在,请重新输入",t.sysUser.username="")})},t.Modal.organization=function(){t.placeholder.organization="必填",t.placeholder.organization_code="必填，根据机构名称自动生成",t.organization=!1;var e=t.sysUser.organization,a=t.sysUser.dep_id;e&&o.getUserOrganizationIsEqual({organization:e,dep_id:a}).then(function(e){"false"==e.data.body[0].isexists?(t.placeholder.organization="机构名称已存在，请重新输入",t.organization=!0,t.sysUser.organization=""):t.organization=!1})},t.Modal.validPhone=function(){t.placeholder.phone="必填",t.validPhone=!1;var e=/^(\d{3,4}-)?\d{7,8}$|(^1[3|4|5|7|8]\d{9}$)/;e.test(t.sysUser.phone)||null==t.sysUser.phone||(t.validPhone=!0,t.placeholder.phone="电话格式不对",t.sysUser.phone="")},t.Modal.validEmail=function(e){t.placeholder.email="必填",t.validEmail=!1,e&&(t.validEmail=!0,t.placeholder.email="邮箱格式不对",t.sysUser.email="")}}),a.result.then(function(){o.updateUser(t.sysUser).then(function(e){p.limit=10,p.skip=0,t.Paging.currentPage=1,200==e.data.head.status?alert("修改成功"):alert("修改失败"),l(p)})})},t.Password=function(e){t.placeholder.password_1="必填",t.placeholder.password_2="必填",t.placeholder.password_3="必填";var a=0;a=e.id,t.Modal.password_pre="",t.Modal.p2="",t.Modal.password="",t.password_1=!1,t.password_2=!1,t.password_3=!1;var n=r.popModal(t,"密码","update-password-modal");n.opened.then(function(){t.Modal.validPword1=function(){t.password_1=!1,t.placeholder.password_1="必填",o.validatePassword({id:a,password:t.Modal.password_pre}).then(function(e){0==e.data.head.total&&(t.password_1=!0,t.placeholder.password_1="原密码不对,请重新输入",t.Modal.password_pre="")})},t.Modal.validPword=function(){t.password_3=!1,t.placeholder.password_3="必填",t.Modal.p2!=t.Modal.password&&(t.password_3=!0,t.placeholder.password_3="两次输入的密码不同,请重新输入",t.Modal.password="")}}),n.result.then(function(){o.UpdatePassword({id:a,password:t.Modal.password}).then(function(e){200==e.data.head.status?alert("修改成功"):alert("修改失败"),p.limit=10,p.skip=0,t.Paging.currentPage=1,l(p),c()})})},t.searchUser=function(){p.limit=10,p.skip=0,p.dep_id=d,p.sysusername=t.username,null==t.username?(c(),l(p)):o.getUserList(p).then(function(e){e.data.head.total>=1?(t.users=e.data.body,t.UserTotal=e.data.head.total,t.Paging.totalItems=t.UserTotal):(alert("系统没有查到'"+t.username+"'这个用户名，请重新输入"),s.go("main.admin.user",{},{reload:!0}))})}}]),AdminUser.factory("AdminUser.Service.Http",["$http","API",function(e,t){function a(t){return e.get(m+"/sys_user/organization_code",{params:t})}function n(t){return e.get(m+"/sys_user/organization",{params:t})}function o(t){return e.get(m+"/sys_user",{params:t})}function r(t){return e.get(m+"/sys_user/count",{params:t})}function i(t){return e.get(m+"/sys_dep",{params:t})}function s(t){return e.post(m+"/sys_user",{data:t})}function l(t){return e.put(m+"/sys_user",{data:t})}function c(t){return e["delete"](m+"/sys_user",{data:{id:t.id}})}function u(t){return e.get(m+"/sys_user/password",{params:t})}function d(t){return e.put(m+"/sys_user/password",{data:t})}var m=t.path;return{getUserOrganizationCode:a,getUserOrganizationIsEqual:n,getUserList:o,saveUser:s,getDepartmentList:i,updateUser:l,deleteUser:c,getUserTotal:r,validatePassword:u,UpdatePassword:d}}]),AdminUser.service("AdminUser.Service.Component",["$uibModal","$state",function(e,t){function a(e,t){e.Alerts=[{type:t.type,message:t.message,timeout:1200}],e.CloseAlert=function(t){e.Alerts.splice(t,1)}}function n(a,n,o){a.Modal.type=n;var r=e.open({animation:!0,backdrop:"static",templateUrl:o+".html",scope:a,size:"md"});return a.Modal.confirm=function(e){e&&r.close(a.Modal)},a.Modal.cancel=function(){r.dismiss(),t.go("main.admin.user",{},{reload:!0})},r}return{popAlert:a,popModal:n}}]);var Dashboard=angular.module("Dashboard",["ui.router","ui.bootstrap"]);Dashboard.controller("Dashboard.Controller.Main",["$cookies","$scope","Dashboard.Service.Http","Dashboard.Requirement.Service.Component",function(e,t,a,n){function o(){a.getDataRequirementNew({skip:0,limit:7,response_dep_id:s}).then(function(e){200==e.data.head.status&&(t.Requirements=e.data.body[0].results)})}function r(){a.getDeptInfoResourceList(l).then(function(e){console.log(e),200==e.data.head.status?(t.depInfoResourceList=e.data.body[0].results,t.ModalPaging.totalItems=e.data.body[0].count):t.depInfoResourceList=[]})}var i=JSON.parse(e.get("User")),s=i.dep_id;a.getDepartments().then(function(e){200==e.data.head.status&&(t.Bureaus=e.data.body)}),t.DataquotaSummary=a.getDataquotaSummary(),t.DataRequirementSummary=a.getDataRequirementSummary(),a.getDataquotaSummary().then(function(e){t.SummaryDataQuota=e.data.body[0]}),a.getDataRequirementSummary().then(function(e){t.SummaryRequirement=e.data.body[0]}),a.getDataQuotaNew({skip:0,limit:7}).then(function(e){200==e.data.head.status&&(t.NewIndicators=e.data.body)}),o(),t.select=function(e){t.departmentID={resource_dep_id:e},a.getDataQuota({skip:0,limit:5,dep_name:e}).then(function(e){t.followDepIndicators=e.data.body[0].results})},t.ModalPaging={},t.ModalPaging.currentPage=1,t.ModalPaging.maxSize=5,t.ModalPaging.itemsPerPage=10,t.resParent={},t.resParent.dropListShow=!1;var l={};l.limit=10,l.skip=0,r(),t.ModalPaging.pageChanged=function(){l.skip=(t.ModalPaging.currentPage-1)*l.limit,a.getDeptInfoResourceList(l).then(function(e){console.log(e),t.depInfoResourceList=e.data.body[0].results,t.ModalPaging.totalItems=e.data.body[0].count})},a.getSystemDictByCatagory({dict_category:11}).then(function(e){t.resourceFormatList=e.data.body}),t.resourceSelection=[],t.toggleResourceSelection=function(e,a){var n=t.resourceSelection.indexOf(e);n>-1?(t.resourceSelection=[],t.checkedResourceName=""):(t.resourceSelection=e,t.resource_id=e,t.resourceItemSelection=[],t.checkedResourceName='已选中资源 "'+a+'"'),console.log(t.resourceItemSelection)},t.resourceItemSelection=[],t.toggleResItemSelection=function(e,a,n){t.resource_id!=e&&(t.resourceItemSelection=[],t.resource_id=e);var o=t.resourceItemSelection.indexOf(a.id);if(o>-1){t.resourceItemSelection.splice(o,1);var r=t.resourceItemSelection.length;console.log(r),0==r?t.checkedResourceName="":t.checkedResourceName='已选中资源 "'+n+'"下的'+r+"条信息项"}else{t.resourceItemSelection.push(a.id);var r=t.resourceItemSelection.length;t.checkedResourceName='已选中资源 "'+n+'"下的'+r+"条信息项",t.resourceSelection=[]}console.log(t.resourceItemSelection)},t.saveChooseResource=function(){console.log(t.resourceItemSelection),console.log(t.resourceSelection),0==t.resourceItemSelection.length&&0==t.resourceSelection.length?t.errorMsg="您未选中任何资源。":(t.resParent.dropListShow=!1,t.errorMsg="")},t.resFormatMainSelection=[],t.getInfoResourceByResFormat=function(e){var a=t.resFormatMainSelection.indexOf(e.id);a>-1?t.resFormatMainSelection=[]:t.resFormatMainSelection=e.id,l.resource_format=t.resFormatMainSelection,l.limit=10,l.skip=0,r(l)},t.getResFormatAll=function(){t.resFormatMainSelection=[],l.resource_format=null,l.limit=10,l.skip=0,r(l)},t.openItems=function(e,n){t.collapseIndex=e,t.closeShow=!0,t.showIndex=e,t.InfoItems=[],a.getInfoItemList({resource_id:n}).then(function(e){0==e.data.body.length?t.InfoItemShow=!1:(t.InfoItemShow=!0,t.InfoItems=e.data.body,_(t.InfoItems).forEach(function(e){var t=[];_(e.config).forEach(function(e){t.push(e.dict_name)}),e.update_period_name=t.toString()}))})},t.closeItems=function(e){t.collapseIndex=-1,t.closeShow=!1,t.InfoItems=[]},t.togglResourceList=function(){t.resParent.dropListShow?t.resParent.dropListShow=!1:t.resParent.dropListShow=!0},t.RequirementConfirm=function(e){t.Modal={},t.Modal.ReqDetail=e,t.Modal.ReqResponse={},t.resourceItemSelection=[],t.resourceSelection=[],t.resource_id=null,t.closeShow=!1,t.showIndex=-1,t.collapseIndex=-1,0==t.depInfoResourceList.length&&(t.Modal.ReqResponse.resource_id="",t.errorMsg="本部门还未发布任何信息资源",t.dataQuotaIdNull=!0),n.popModalConfirm(t,"","confirm-req-modal").result.then(function(){t.Modal.ReqResponse.resource_id=t.resource_id,console.log(t.Modal.ReqResponse),console.log(t.resourceItemSelection),t.Modal.ReqResponse.requiement_id=e.id,a.updateRequirement(t.Modal.ReqResponse).then(function(n){if(200==n.data.head.status)if(1==t.Modal.ReqResponse.status){var r=[];if(0==t.resourceItemSelection.length){var i={};i.requiement_id=e.id,i.resource_id=t.Modal.ReqResponse.resource_id,i.item_id="",r.push(i)}else _(t.resourceItemSelection).forEach(function(a){var n={};n.requiement_id=e.id,n.resource_id=t.Modal.ReqResponse.resource_id,n.item_id=a,r.push(n)});a.saveReqResponse(r).then(function(e){200==e.data.head.status?(alert("保存成功！"),o()):(alert("保存失败！"),o())})}else alert("保存成功！"),o();else alert("保存失败")})})},a.getUserDep().then(function(e){return 200===e.data.head.status&&e.data.body.length>=1?(t.followDeps=e.data.body,e.data.body[0].id):0}).then(function(e){a.getDataQuota({skip:0,limit:5,dep_name:e}).then(function(e){t.followDepIndicators=e.data.body[0].results})})}]),Dashboard.factory("Dashboard.Service.Http",["$http","API",function(e,t){function a(t){return e.put(f+"/data_requiement_ok",{data:t})}function n(t){return e.post(f+"/data_requiement_response",{data:t})}function o(t){return e.get(f+"/data_resource/new",{params:t})}function r(t){return e.get(f+"/data_requiement",{params:t})}function i(){return e.get(f+"/sys_dep")}function s(){return e.get(f+"/data_resource/summary")}function l(){return e.get(f+"/data_requiement/summary")}function c(t){return e.get(f+"/department",{params:t})}function u(t){return e.get(f+"/data_quota",{params:t})}function d(t){return e.get(f+"/dep_resource_list",{params:t})}function m(t){return e.get(f+"/allitem_detail",{params:t})}function p(t){return e.get(f+"/sys_dict",{params:t})}var f=t.path;return{updateRequirement:a,saveReqResponse:n,getDataQuotaNew:o,getDataRequirementNew:r,getDepartments:i,getDataquotaSummary:s,getDataRequirementSummary:l,getUserDep:c,getDataQuota:u,getDeptInfoResourceList:d,getInfoItemList:m,getSystemDictByCatagory:p}}]),Dashboard.directive("wiservDataQuotaOverviewChart",[function(){return{restrict:"AE",template:"<div style='width:300;height:215px;position:relative;top:-1px;'></div>",link:function(e,t,a){e.DataquotaSummary.then(function(e){if(200==e.data.head.status){var a=e.data.body[0],n=echarts.init(t.find("div")[0]),o={tooltip:{formatter:"{a} <br/>{c} {b}"},series:[{name:"资源总数",type:"gauge",center:["69%","55%"],z:3,min:0,max:220-a.total_resource<50?11*Math.ceil(a.total_resource/11)+55:220,splitNumber:11,radius:"90%",axisLine:{lineStyle:{width:5}},axisTick:{length:15,lineStyle:{color:"auto"}},splitLine:{length:20,lineStyle:{color:"auto"}},pointer:{width:3},title:{offsetCenter:[0,"-10%"],textStyle:{fontWeight:"",fontSize:15,fontStyle:"italic"}},detail:{textStyle:{fontWeight:""}},data:[{value:a?a.total_resource:0,name:"条（资源总数）"}]},{name:"本月新增",type:"gauge",center:["23%","65%"],radius:"65%",min:0,max:70-a.month_increment_resource<10?7*Math.ceil(a.month_increment_resource/7)+14:70,endAngle:20,splitNumber:7,axisLine:{lineStyle:{width:3}},axisTick:{length:10,lineStyle:{color:"auto"}},splitLine:{length:13,lineStyle:{color:"auto"}},pointer:{width:3},title:{offsetCenter:[0,"-1%"],textStyle:{fontSize:10,fontStyle:"italic"}},detail:{},data:[{value:a?a.month_increment_resource:0,name:"条(本月新增)"}]}]};n.setOption(o)}})}}}]),Dashboard.directive("wiservRequirementOverviewChart",[function(){return{restrict:"AE",template:"<div style='width:300;height:215px;position:relative;top:-1px'></div>",link:function(e,t,a){e.DataRequirementSummary.then(function(e){if(200==e.data.head.status){var a=e.data.body[0],n=echarts.init(t.find("div")[0]),o={tooltip:{formatter:"{a} <br/>{c} {b}"},series:[{name:"需求总数",type:"gauge",center:["69%","55%"],z:3,min:0,max:220-a.requiement_number<50?11*Math.ceil(a.requiement_number/11)+55:220,splitNumber:11,radius:"90%",axisLine:{lineStyle:{width:5}},axisTick:{length:15,lineStyle:{color:"auto"}},splitLine:{length:20,lineStyle:{color:"auto"}},pointer:{width:3},title:{offsetCenter:[0,"-10%"],textStyle:{fontWeight:"",fontSize:15,fontStyle:"italic"}},detail:{textStyle:{fontWeight:""}},data:[{value:a?a.requiement_number:0,name:"条（需求总数）"}]},{name:"本月新增",type:"gauge",center:["23%","65%"],radius:"65%",min:0,max:70-a.requiement_number_inc<10?7*Math.ceil(a.requiement_number_inc/7)+14:70,endAngle:20,splitNumber:7,axisLine:{lineStyle:{width:3}},axisTick:{length:10,lineStyle:{color:"auto"}},splitLine:{length:13,lineStyle:{color:"auto"}},pointer:{width:3},title:{offsetCenter:[0,"-1%"],textStyle:{fontSize:10,fontStyle:"italic"}},detail:{},data:[{value:a?a.requiement_number_inc:0,name:"条(本月新增)"}]}]};n.setOption(o)}})}}}]),Dashboard.directive("wiservStatisticChart",[function(){return{restrict:"AE",template:"<div style='width:100%;height:240px;'></div>",link:function(e,t,a){e.QInventoryStatistic.then(function(e){var a=e.data.body[0],n=e.data.body[1],o=e.data.body[2],r=echarts.init(t.find("div")[0]),i={tooltip:{trigger:"axis"},legend:{data:["资源","需求"]},xAxis:[{type:"category",name:"数量",data:a.DEPARTMENT}],yAxis:[{type:"value",name:"单位",min:0,max:30,interval:30,axisLabel:{formatter:"{value} 个"}}],series:[{name:"资源",type:"bar",data:n.INVENTORY},{name:"需求",type:"bar",data:o.REQUIREMENT}]};r.setOption(i)})}}}]),Dashboard.service("Dashboard.Requirement.Service.Component",["$uibModal",function(e){function t(e,t){e.Alerts=[{type:t.type,message:t.message,timeout:1200}],e.CloseAlert=function(t){e.Alerts.splice(t,1)}}function a(t,a,n){t.Modal.type=a;var o=e.open({animation:!0,backdrop:"static",templateUrl:n+".html",scope:t,size:"lg"});return t.Modal.confirm=function(e){console.log(t),0==t.resourceSelection.length&&0==t.resourceItemSelection.length&&1==t.Modal.ReqResponse.status?(t.errorMsg="请选择信息资源！",e=!1):t.errorMsg="",e&&o.close(t.Modal)},t.Modal.cancel=function(){o.dismiss()},o}function n(t,a,n){t.Modal.type=a;var o=e.open({animation:!0,backdrop:"static",templateUrl:n+".html",scope:t,size:"lg"});return t.Modal.confirm=function(e){console.log(t),t.submitted=!0,0==t.reqParent.outputDeptList.length?t.error=!0:0==t.shareFreqSelection.length||o.close(t.Modal)},t.Modal.cancel=function(){o.dismiss()},o}return{popAlert:t,popModal:n,popModalConfirm:a}}]);var Login=angular.module("Login",["ui.router","ngCookies"]);Login.controller("Login.Controller.Main",["$rootScope","$cookies","$scope","$state","Login.Service.Http",function(e,t,a,n,o){sessionStorage.token&&sessionStorage.removeItem("token"),sessionStorage.message&&(a.alerts=[{type:"danger",msg:sessionStorage.message}],a.closeAlert=function(e){a.alerts.splice(e,1)},sessionStorage.removeItem("message")),a.Login={},a.Login.submit=function(r){if(a.loginSubmitted=!1,r){var i=a.Login.username,s=hex_md5(a.Login.password);o.login({username:i,password:s}).then(function(o){var r=o.data.body[0];e.User=r,t.put("User",JSON.stringify(r)),console.log(JSON.stringify(r));var i=o.data.head.token;i&&(sessionStorage.token=i),200==o.data.head.status?n.go("main.dashboard"):a.loginError=!0})}else a.loginSubmitted=!0}}]),Login.factory("Login.Service.Http",["$http","API",function(e,t){function a(t){return e.post(n+"/login",{data:t})}var n=t.path;return{login:a}}]);var Main=angular.module("Main",["ui.router","ngCookies"]);Main.controller("Main.Controller.Main",["$scope","$cookies","Main.Service.Http","$state",function(e,t,a,n){e.User=JSON.parse(t.get("User")),e.logout=function(){console.log(e.User),sessionStorage.token&&(sessionStorage.removeItem("token"),a.logout().then(function(e){n.go("welcome")}))}}]),Main.factory("Main.Service.Http",["$http","API",function(e,t){function a(){return e.get(n+"/loginOut")}var n=t.path;return{logout:a}}]);var Welcome=angular.module("Welcome",["ui.router"]);Welcome.controller("Welcome.Controller.Main",["$scope","$state","Welcome.Service.Http","$stateParams","$document",function(e,t,a,n,o){function r(){e.flag=n.type?n.type:1,e.filterName=n.titleName?n.titleName:"机构类型",e.currentTabFlash=n.type?n.type:1,a.menu().then(function(t){200===t.data.head.status&&(e.list=t.data.body)}),a.menuRole().then(function(t){200===t.data.head.status&&(e.OcupationList=t.data.body)}),a.menuArea().then(function(t){200===t.data.head.status&&(e.areaList=t.data.body)}),a.menuTheme().then(function(t){200===t.data.head.status&&(e.themeList=t.data.body)})}function i(t){a.getDataQuota(t).then(function(t){e.DataQuotas=t.data.body[0].results,e.DataQuotasTotal=t.data.body[0].count[0].resource_count,
e.Paging.totalItems=t.data.body[0].count[0].resource_count})}function s(){e.resourceFormatActiveAll=e.ShareLevelActiveAll=e.openToSocietyActiveAll=e.ShareFrequencyActiveAll=e.DataLevelActiveAll=e.isScretActiveAll="active";var t={};t=""===c?d:_.assign(t,c,d),i(t)}function l(e){var t={};t=""===c.dep_name?d:_.assign(t,c,d),_.assign(t,e),i(t)}window.scrollTo(0,0),e.treeOptions={nodeChildren:"nodes",dirSelectable:!1,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a2",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},r(),e.treeChangeType=function(t){e.predicate="",1==t?(e.flag=1,e.filterName="机构类型",a.menu().then(function(t){200===t.data.head.status&&(e.list=t.data.body)})):2==t?(e.filterName="机构职能",e.flag=2,a.menuRole().then(function(t){200===t.data.head.status&&(e.OcupationList=t.data.body)})):3==t?(e.filterName="区域",e.flag=3,a.menuArea().then(function(t){200===t.data.head.status&&(e.areaList=t.data.body)})):4==t&&(e.filterName="主题",e.flag=4,a.menuTheme().then(function(t){200===t.data.head.status&&(e.themeList=t.data.body)}))},e.comparator=!1,e.showSelected=function(t){e.selectedNode=t};var c={resource_dep_id:n.resource_dep_id},u={dep_name:n.dep_name};e.currentDep=u.dep_name;var d={limit:10,skip:0};e.Paging={},e.Paging.currentPage=1,e.Paging.maxSize=5,e.Paging.itemsPerPage=10,e.Paging.pageChanged=function(){var t={};_.assign(t,c,{limit:10,skip:10*(e.Paging.currentPage-1)},{resource_name:e.TargetDataQuotaName}),i(t)},s(),e.WelcomeDep=function(t,a){if(t){e.TargetDataQuotaName="";var n={};c={resource_dep_id:t},u={dep_name:a},e.currentDep=u.dep_name,e.resourceFormatActiveAll=e.ShareLevelActiveAll=e.openToSocietyActiveAll=e.ShareFrequencyActiveAll=e.DataLevelActiveAll=e.isScretActiveAll="active",n=""===c?d:_.assign(n,c,d),i(n)}},e.Retrieval=function(){var t={},a={resource_name:e.TargetDataQuotaName};""===c?_.assign(t,d,a):_.assign(t,c,d,a),i(t)};var m=1,p=2,f=3,g=11,h=14,y=5;a.getSystemDictByCatagory({dict_category:g}).then(function(t){e.resourceFormats=t.data.body}),a.getSystemDictByCatagory({dict_category:h}).then(function(t){e.openToSocietys=t.data.body}),a.getSystemDictByCatagory({dict_category:y}).then(function(t){e.isScrets=t.data.body}),a.getSystemDictByCatagory({dict_category:f}).then(function(t){var a=t.data.body;_.remove(a,function(e){return"暂不开放"==e.dict_name}),e.ShareLevels=a}),a.getSystemDictByCatagory({dict_category:m}).then(function(t){e.ShareFrequencys=t.data.body}),a.getSystemDictByCatagory({dict_category:p}).then(function(t){e.DataLevels=t.data.body});var v={};e.resourceFormatFilter=function(t,a){e.resourceFormatActive=[],e.resourceFormatActiveAll="",e.resourceFormatActive[a]="active",v.re_format=t,"ALL"===t?(delete v.re_format,e.resourceFormatActiveAll="active",l(v)):l(v)},e.ShareLevelFilter=function(t,a){e.ShareLevelActive=[],e.ShareLevelActiveAll="",e.ShareLevelActive[a]="active",v.share_level=t,"ALL"===t?(delete v.share_level,e.ShareLevelActiveAll="active",l(v)):l(v)},e.openToSocietyFilter=function(t,a){e.openToSocietyActive=[],e.openToSocietyActiveAll="",e.openToSocietyActive[a]="active",v.social_open_flag=t,"ALL"===t?(delete v.social_open_flag,e.openToSocietyActiveAll="active",l(v)):l(v)},v.update_period=[],e.ShareFrequencyActive=[],e.ShareFrequencyFilter=function(t,a){if("ALL"===t)v.update_period=[],e.ShareFrequencyActiveAll="active",e.ShareFrequencyActive=[],l(v);else{e.ShareFrequencyActiveAll="";var n=v.update_period.indexOf(t);"active"===e.ShareFrequencyActive[a]?e.ShareFrequencyActive[a]="":e.ShareFrequencyActive[a]="active",n>-1?1===v.update_period.length?(e.ShareFrequencyActiveAll="active",v.update_period=[]):v.update_period.splice(n,1):v.update_period.push(t),l(v)}},v.area_level=[],e.DataLevelActive=[],e.DataLevelFilter=function(t,a){if("ALL"===t)v.area_level=[],e.DataLevelActiveAll="active",e.DataLevelActive=[],l(v);else{var n=v.area_level.indexOf(t);e.DataLevelActiveAll="","active"===e.DataLevelActive[a]?e.DataLevelActive[a]="":e.DataLevelActive[a]="active",n>-1?1===v.area_level.length?(e.DataLevelActiveAll="active",v.area_level=[]):v.area_level.splice(n,1):v.area_level.push(t),l(v)}},e.isScretFilter=function(t,a){e.isScretActive=[],e.isScretActiveAll="",e.isScretActive[a]="active",v.issecret=t,"ALL"===t?(delete v.issecret,e.isScretActiveAll="active",l(v)):l(v)}}]),Welcome.factory("Welcome.Service.Http",["$http","API",function(e,t){function a(t){return e.get(l+"/menu",{params:t})}function n(t){return e.get(l+"/menu_role",{params:t})}function o(t){return e.get(l+"/menu_area",{params:t})}function r(t){return e.get(l+"/menu_theme",{params:t})}function i(t){return e.get(l+"/sys_dict",{params:t})}function s(t){return e.get(l+"/resource_list",{params:t})}var l=t.path;return{menu:a,menuRole:n,menuArea:o,menuTheme:r,getSystemDictByCatagory:i,getDataQuota:s}}]),Welcome.directive("wiservMainWrapperUnlogin",[function(){return{restrict:"AE",link:function(e,t,a){e.currentTab=e.currentTabFlash,t.find(".toggler").on("click",function(a){e.currentTab==e.flag?t.hasClass("content-collapse")||(t.find(".searchTree").toggleClass("searchTree-collapse"),t.find(".content").toggleClass("content-collapse")):(t.find(".searchTree").removeClass("searchTree-collapse").addClass("searchTree-collapse"),t.find(".content").removeClass("content-collapse")),e.currentTab=e.flag})}}}]);var DataQuotaDetail=angular.module("DataQuotaDetail",["ui.router"]);DataQuotaDetail.controller("DataQuotaDetail.Controller.Main",["$scope","$state","DataQuotaDetail.Service.Http","$stateParams","$sce",function(e,t,a,n,o){a.getDataQuotaDetailByDepID(n).then(function(t){e.DataQuotaDetail=t.data.body[0]}),a.getDataQuotaExampleByDepID({resource_id:n.resource_id}).then(function(t){e.DataQuotaExample=t.data.body}),e.DataExamples=a.getResourceExampleDatas({resource_id:n.resource_id}),e.DataquotaRequirementByDepTotals=a.getDataQuotaRequirementByDepTotals({resource_id:n.resource_id})}]),DataQuotaDetail.factory("DataQuotaDetail.Service.Http",["$http","API",function(e,t){function a(t){return e.get(i+"/info_resource_examples",{params:t})}function n(t){return e.get(i+"/info_resource_detail",{params:t})}function o(t){return e.get(i+"/info_item_detail",{params:t})}function r(t){return e.get(i+"/info_item_requirementDeps",{params:t})}var i=t.path;return{getResourceExampleDatas:a,getDataQuotaDetailByDepID:n,getDataQuotaExampleByDepID:o,getDataQuotaRequirementByDepTotals:r}}]),DataQuotaDetail.directive("wiservExampleDataShow",[function(){return{restrict:"AE",template:"<div style='width:500px;height:400px;position:relative;top: -9px;'></div>",link:function(e,t,a){console.log(e),e.DataExamples.then(function(e){console.log(e),e.data.body[0]&&t.html(e.data.body[0].file_content)})}}}]),DataQuotaDetail.directive("requirementDepatmentRelationship",[function(){return{restrict:"AE",template:"<div style='width:900px;height:400px;position:relative;top:20px;text-overflow:ellipsis'></div>",link:function(e,t,a){e.DataquotaRequirementByDepTotals.then(function(e){if(200==e.data.head.status){var a=e.data.body[0],n=_.size(a.depNames),o=(a.resourceName,a.depNames),r=[{category:0,name:"当前信息资源",value:10,label:"当前信息资源"}],i=[];n&&_(o).forEach(function(e,t){var a={};a.category=1,a.name=e,a.value=2,r.push(a);var n={};n.source="当前信息资源",n.target=e,n.weight=1,i.push(n)});var s=echarts.init(t.find("div")[0]),l={title:{text:"当前信息资源对应的需求部门为"+n+"个",x:"center",y:"top"},tooltip:{trigger:"item",formatter:"{a} : {b}"},legend:{x:"left",data:["需求部门"]},series:[{type:"force",name:"当前信息资源-需求部门",ribbonType:!1,categories:[{name:"当前信息资源"},{name:"需求部门"}],itemStyle:{normal:{label:{show:!0,textStyle:{color:"#333"}},nodeStyle:{brushType:"both",borderColor:"rgba(255,215,0,0.4)",borderWidth:1}},emphasis:{label:{show:!1},nodeStyle:{},linkStyle:{}}},minRadius:15,maxRadius:25,gravity:1.1,scaling:1.1,draggable:!1,linkSymbol:"arrow",steps:10,coolDown:.9,roam:"move",nodes:r,links:i}]};s.setOption(l)}})}}}]);var DataQuotaList=angular.module("DataQuotaList",["ui.router"]);DataQuotaList.controller("DataQuotaList.Controller.Main",["$scope","$state","DataQuotaList.Service.Http","$stateParams",function(e,t,a,n){function o(t){a.getDataQuota(t).then(function(t){e.DataQuotas=t.data.body[0].results,e.DataQuotasTotal=t.data.body[0].count[0].resource_count,e.Paging.totalItems=t.data.body[0].count[0].resource_count})}function r(e){var t={};t=""===i.dep_name?l:_.assign(t,i,l),_.assign(t,e),o(t)}var i={resource_dep_id:n.resource_dep_id},s={dep_name:n.dep_name};e.currentDep=s.dep_name;var l={limit:10,skip:0};e.Paging={},e.Paging.currentPage=1,e.Paging.maxSize=5,e.Paging.itemsPerPage=10,e.Paging.pageChanged=function(){var t={};_.assign(t,i,{limit:10,skip:10*(e.Paging.currentPage-1)},{resource_name:e.TargetDataQuotaName}),o(t)},function(){e.resourceFormatActiveAll=e.ShareLevelActiveAll=e.openToSocietyActiveAll=e.ShareFrequencyActiveAll=e.DataLevelActiveAll=e.isScretActiveAll="active";var t={};t=""===i?l:_.assign(t,i,l),o(t)}(),e.Retrieval=function(){var t={},a={resource_name:e.TargetDataQuotaName};""===i?_.assign(t,l,a):_.assign(t,i,l,a),o(t)},e.DataQuotaApplyInfo=function(t){a.getDataQuotaApplyInfo({info_resource_id:t}).then(function(){var t={};_.assign(t,i,{limit:10,skip:10*(e.Paging.currentPage-1)},{resource_name:e.TargetDataQuotaName}),o(t)})};var c=1,u=2,d=3,m=11,p=14,f=5;a.getSystemDictByCatagory({dict_category:m}).then(function(t){e.resourceFormats=t.data.body}),a.getSystemDictByCatagory({dict_category:p}).then(function(t){e.openToSocietys=t.data.body}),a.getSystemDictByCatagory({dict_category:f}).then(function(t){e.isScrets=t.data.body}),a.getSystemDictByCatagory({dict_category:d}).then(function(t){e.ShareLevels=t.data.body}),a.getSystemDictByCatagory({dict_category:c}).then(function(t){e.ShareFrequencys=t.data.body}),a.getSystemDictByCatagory({dict_category:u}).then(function(t){e.DataLevels=t.data.body});var g={};e.resourceFormatFilter=function(t,a){e.resourceFormatActive=[],e.resourceFormatActiveAll="",e.resourceFormatActive[a]="active",g.re_format=t,"ALL"===t?(delete g.re_format,e.resourceFormatActiveAll="active",r(g)):r(g)},e.ShareLevelFilter=function(t,a){e.ShareLevelActive=[],e.ShareLevelActiveAll="",e.ShareLevelActive[a]="active",g.share_level=t,"ALL"===t?(delete g.share_level,e.ShareLevelActiveAll="active",r(g)):r(g)},e.openToSocietyFilter=function(t,a){e.openToSocietyActive=[],e.openToSocietyActiveAll="",e.openToSocietyActive[a]="active",g.social_open_flag=t,"ALL"===t?(delete g.social_open_flag,e.openToSocietyActiveAll="active",r(g)):r(g)},g.update_period=[],e.ShareFrequencyActive=[],e.ShareFrequencyFilter=function(t,a){if("ALL"===t)g.update_period=[],e.ShareFrequencyActiveAll="active",e.ShareFrequencyActive=[],r(g);else{e.ShareFrequencyActiveAll="";var n=g.update_period.indexOf(t);"active"===e.ShareFrequencyActive[a]?e.ShareFrequencyActive[a]="":e.ShareFrequencyActive[a]="active",n>-1?1===g.update_period.length?(e.ShareFrequencyActiveAll="active",g.update_period=[]):g.update_period.splice(n,1):g.update_period.push(t),r(g)}},g.area_level=[],e.DataLevelActive=[],e.DataLevelFilter=function(t,a){if("ALL"===t)g.area_level=[],e.DataLevelActiveAll="active",e.DataLevelActive=[],r(g);else{var n=g.area_level.indexOf(t);e.DataLevelActiveAll="","active"===e.DataLevelActive[a]?e.DataLevelActive[a]="":e.DataLevelActive[a]="active",n>-1?1===g.area_level.length?(e.DataLevelActiveAll="active",g.area_level=[]):g.area_level.splice(n,1):g.area_level.push(t),r(g)}},e.isScretFilter=function(t,a){e.isScretActive=[],e.isScretActiveAll="",e.isScretActive[a]="active",g.issecret=t,"ALL"===t?(delete g.issecret,e.isScretActiveAll="active",r(g)):r(g)}}]),DataQuotaList.factory("DataQuotaList.Service.Http",["$http","API",function(e,t){function a(t){return e.get(r+"/sys_dict",{params:t})}function n(t){return e.get(r+"/resource/sys_dict",{params:t})}function o(t){return e.post(r+"/info_resource_apply_info",{data:t})}var r=t.path;return{getSystemDictByCatagory:a,getDataQuotaApplyInfo:o,getDataQuota:n}}]);var DataQuota=angular.module("DataQuota",["ui.router"]);DataQuota.controller("DataQuota.Controller.Main",["$scope","$state","DataQuota.Service.Http","$stateParams",function(e,t,a,n){function o(){e.predicate="",e.flag=n.type?n.type:1,e.filterName=n.titleName?n.titleName:"机构类型",e.currentTabFlash=n.type?n.type:1,a.menu().then(function(t){200===t.data.head.status&&(e.list=t.data.body)}),a.menuRole().then(function(t){200===t.data.head.status&&(e.OcupationList=t.data.body)}),a.menuArea().then(function(t){200===t.data.head.status&&(e.areaList=t.data.body)}),a.menuTheme().then(function(t){200===t.data.head.status&&(e.themeList=t.data.body)})}window.scrollTo(0,0),e.treeOptions={nodeChildren:"nodes",dirSelectable:!1,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a2",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},o(),e.typeListOpen=function(){e.predicate="",e.flag=1,e.filterName="机构类型",a.menu().then(function(t){200===t.data.head.status&&(e.list=t.data.body)})},e.ocupationListOpen=function(){e.predicate="",e.filterName="机构职能",e.flag=2,a.menuRole().then(function(t){200===t.data.head.status&&(e.OcupationList=t.data.body)})},e.areaListOpen=function(){e.predicate="",e.filterName="区域",e.flag=3,a.menuArea().then(function(t){200===t.data.head.status&&(e.areaList=t.data.body)})},e.themeListOpen=function(){e.predicate="",e.filterName="主题",e.flag=4,a.menuTheme().then(function(t){200===t.data.head.status&&(e.themeList=t.data.body)})},e.comparator=!1,e.showSelected=function(t){e.selectedNode=t}}]),DataQuota.factory("DataQuota.Service.Http",["$http","API",function(e,t){function a(t){return e.get(i+"/menu",{params:t})}function n(t){return e.get(i+"/menu_role",{params:t})}function o(t){return e.get(i+"/menu_area",{params:t})}function r(t){return e.get(i+"/menu_theme",{params:t})}var i=t.path;return{menu:a,menuRole:n,menuArea:o,menuTheme:r}}]),DataQuota.directive("wiservMainWrapper",[function(){return{restrict:"AE",link:function(e,t,a){e.currentTab=e.currentTabFlash,t.find(".toggler").on("click",function(a){e.currentTab==e.flag?t.hasClass("content-collapse")||(t.find(".searchTree").toggleClass("searchTree-collapse"),t.find(".content").toggleClass("content-collapse")):(t.find(".searchTree").removeClass("searchTree-collapse").addClass("searchTree-collapse"),t.find(".content").removeClass("content-collapse")),e.currentTab=e.flag})}}}]);var Audit=angular.module("Department.Audit",["ui.router"]);Audit.controller("Department.Audit.Controller.Main",["$scope","$q","Department.Audit.Service.Http",function(e,t,a){function n(){e.auditPromise=a.getAuditList(o).then(function(t){e.auditList=t.data.body[0].results,e.resourceCount=t.data.body[0].count[0].resource_count,e.Paging.totalItems=t.data.body[0].count[0].resource_count})}e.InfoResource={},e.Paging={},e.Paging.currentPage=1,e.Paging.maxSize=5,e.Paging.itemsPerPage=10;var o={};o.limit=10,o.skip=0,e.Paging.pageChanged=function(){o.skip=(e.Paging.currentPage-1)*o.limit,n(o)},n(),e.searchDeptAuditByName=function(){o.resource_name=e.InfoResource.resource_name_filter,o.limit=10,o.skip=0,n()},e.filterByAuditStatus=function(e){o.auditstatus=e,n()}}]),Audit.controller("Department.Audit.Controller.info",["$scope","$state","$q","Department.Audit.Service.Http","$stateParams",function(e,t,a,n,o){e.TabItemShow=!0,e.TabRequireShow=!0,e.AuditInfo={},e.AuditInfo.audit_opinion="",n.getDepartInfoResList({resource_id:o.RESOURCEID}).then(function(t){e.InfoResourceDetail=t.data.body[0].results[0],e.InfoResourceDetail.apply_dep_name=o.APPLYDEP,e.InfoResourceDetail.apply_time=o.APPLYTIME}),e.InfoItemShow=!1,n.getInfoItemList({resource_id:o.RESOURCEID}).then(function(t){0==t.data.body.length?e.InfoItemShow=!1:(e.InfoItemShow=!0,e.InfoItems=t.data.body)}),e.submitAudit=function(){return console.log(e.AuditInfo.audit_status),e.AuditInfo.audit_status?(e.AuditInfo.audit_id=o.AUDITID,void n.updateAuditDetail(e.AuditInfo).then(function(e){200==e.data.head.status?(alert("审核成功"),t.go("main.department.audit",{},{reload:!0})):alert("审核失败")})):void(e.auditError=!0)}}]),Audit.controller("Department.Audit.Controller.detail",["$scope","$state","$q","Department.Audit.Service.Http","$stateParams",function(e,t,a,n,o){e.TabItemShow=!0,e.TabRequireShow=!0,e.AuditInfo={},e.AuditInfo.audit_opinion="",n.getDepartInfoResList({resource_id:o.RESOURCEID}).then(function(t){e.InfoResourceDetail=t.data.body[0].results[0],e.InfoResourceDetail.apply_dep_name=o.APPLYDEP,e.InfoResourceDetail.apply_time=o.APPLYTIME,e.InfoResourceDetail.audit_status=o.AUDITSTATUS,e.InfoResourceDetail.audit_opinion=o.OPINION}),e.InfoItemShow=!1,n.getInfoItemList({resource_id:o.RESOURCEID}).then(function(t){0==t.data.body.length?e.InfoItemShow=!1:(e.InfoItemShow=!0,e.InfoItems=t.data.body)})}]),Audit.factory("Department.Audit.Service.Http",["$http","$q","API",function(e,t,a){function n(t){return e.get(c+"/openinfo_resourcelist",{params:t})}function o(t){return e.get(c+"/data_quota_detail",{params:t})}function r(t){return e.put(c+"/openinfo_resourceok",{data:t})}function i(t){return e.get(c+"/requiement_detail",{params:t})}function s(t){return e.get(c+"/item_detail",{params:t})}function l(t){return e.get(c+"/info_resource_list",{params:t})}var c=a.path;return{getAuditList:n,getInfoResourceDetail:o,updateAuditDetail:r,getQuotaRequirement:i,getInfoItemList:s,getDepartInfoResList:l}}]);var DInventoryDetail=angular.module("Department.InventoryDetail",["ui.router","ngCookies","cgBusy"]);DInventoryDetail.controller("Department.InventoryDetail.Controller",["$scope","$q","Department.InventoryDetail.Service.Http","$stateParams","$state","$sce","API",function(e,t,a,n,o,r,i){i.path;console.log(n.item),e.InfoItemShow=!1,a.getDepartInfoResList({resource_id:n.item}).then(function(t){e.InfoResourceDetail=t.data.body[0].results[0],e.InfoResourceDetail&&e.InfoResourceDetail.resource_format_name.indexOf("数据库类")>-1&&a.getInfoItemList({resource_id:e.InfoResourceDetail.id}).then(function(t){0==t.data.body.length?e.InfoItemShow=!1:(e.InfoItemShow=!0,e.InfoItems=t.data.body,_(e.InfoItems).forEach(function(e){var t=[];_(e.config).forEach(function(e){t.push(e.dict_name)}),e.update_period_name=t.toString()}))})}),e.DataExamples=a.getResourceExampleDatas({resource_id:n.item}),e.ResourceReqByDepTotals=a.getResourceRequirementByDepTotals({resource_id:n.item})}]),DInventoryDetail.factory("Department.InventoryDetail.Service.Http",["$http","$q","API",function(e,t,a){function n(t){return e.get(s+"/info_resource_examples",{params:t})}function o(t){return e.get(s+"/info_item_requirementDeps",{params:t})}function r(t){return e.get(s+"/info_resource_list",{params:t})}function i(t){return e.get(s+"/allitem_detail",{params:t})}var s=a.path;return{getResourceExampleDatas:n,getResourceRequirementByDepTotals:o,getDepartInfoResList:r,getInfoItemList:i}}]),DInventoryDetail.directive("wiservExampleData",[function(){return{restrict:"AE",template:"<div style='width:500px;height:400px;position:relative;top:20px'></div>",link:function(e,t,a){console.log(e),e.DataExamples.then(function(e){console.log(e),e.data.body&&e.data.body[0]&&e.data.body[0].file_content&&t.html(e.data.body[0].file_content)})}}}]),DInventoryDetail.directive("wiservReqdepRelationship",[function(){return{restrict:"AE",template:"<div style='width:900px;height:400px;position:relative;top:20px'></div>",link:function(e,t,a){console.log(e),e.ResourceReqByDepTotals.then(function(e){if(200==e.data.head.status){var a=e.data.body[0],n=_.size(a.depNames),o=(a.resourceName,a.depNames),r=[{category:0,name:"当前信息资源",value:10,label:"当前信息资源"}],i=[];n&&_(o).forEach(function(e,t){var a={};a.category=1,a.name=e,a.value=2,r.push(a);var n={};n.source="当前信息资源",n.target=e,n.weight=1,i.push(n)});var s=echarts.init(t.find("div")[0]),l={title:{text:"当前信息资源对应的需求部门为"+n+"个",x:"center",y:"top"},tooltip:{trigger:"item",formatter:"{a} : {b}"},legend:{x:"left",data:["需求部门"]},series:[{type:"force",name:"当前信息资源-需求部门",ribbonType:!1,categories:[{name:"当前信息资源"},{name:"需求部门"}],itemStyle:{normal:{label:{show:!0,textStyle:{color:"#333"}},nodeStyle:{brushType:"both",borderColor:"rgba(255,215,0,0.4)",borderWidth:1}},emphasis:{label:{show:!1},nodeStyle:{},linkStyle:{}}},minRadius:15,maxRadius:25,gravity:1.1,scaling:1.1,draggable:!1,linkSymbol:"arrow",steps:10,coolDown:.9,roam:"move",nodes:r,links:i}]};s.setOption(l)}})}}}]);var DInventoryUpload=angular.module("Department.InventoryUpload",["ui.router","ngCookies","cgBusy"]);DInventoryUpload.controller("Department.InventoryUpload.Controller",["$scope","$q","Department.InventoryUpload.Service.Http","$stateParams","$state","$sce","API",function(e,t,a,n,o,r,i){e.uploadPromise=null,e.uploadFile=function(){var t=e.myFile;return console.log("file is "),console.dir(t),t?void(e.uploadPromise=a.uploadFile(t).then(function(e){200==e.data.head.status?(alert("上传成功！"),o.go("main.department.inventory",{},{reload:!0})):"error"==e.data.head.message?alert("上传失败"):alert(e.data.head.message)})):void alert("您还未选择文件")},e.downloadUrl=i.path+"/download",e.toIndex=function(){o.go("main.department.inventory",{},{reload:!0})}}]),DInventoryUpload.controller("Department.InventoryUploadExamples.Controller",["$scope","$q","Department.InventoryUpload.Service.Http","$stateParams","$state","$sce","API",function(e,t,a,n,o,r,i){e.uploadPromise=null,e.htmlPopover=r.trustAsHtml("<table class='table table-hover table-striped '><thead><tr><th>序号</th><th>城市</th><th>GDP(亿元)</th><th>增长</th><th>地方公共财政收入(亿元)</th><th>增长</th><th>城镇登记失业率</th><th>农村居民人均纯收入(元)</th><th>增长</th></tr></thead><tbody><tr><td>1</td><td>成都</td><td>9000</td><td>8.54%</td><td>8000</td><td>7.51%</td><td>1.39</td><td>5678</td><td>3.40%</td></tr></tbody></table>"),e.uploadFile=function(){var t=e.myFile,r=!1;return t?void a.checkExistExamples({resource_id:n.ID}).then(function(i){if(200==i.data.head.status)if("true"==i.data.body[0].isexists){var s=confirm("该资源已经存在样例数据，继续上传将覆盖已有的样例数据，是否继续？");s&&(r=!0)}else r=!0;r&&(e.uploadPromise=a.uploadExamplesFile(t,n.ID).then(function(e){200==e.data.head.status?(alert("上传成功！"),o.go("main.department.inventory",{},{reload:!0})):alert("上传失败，上传文件格式有误！")}))}):void alert("您还未选择文件")},e.toIndex=function(){o.go("main.department.inventory",{},{reload:!0})}}]),DInventoryUpload.factory("Department.InventoryUpload.Service.Http",["$http","$q","API",function(e,t,a){function n(t){var a=new FormData,n=i+"/upload/zipFile";a.append("file",t);var o=e.post(n,a,{transformRequest:angular.identity,headers:{"Content-Type":void 0}});return o}function o(t){return e.get(i+"/resource_examples_exists",{params:t})}function r(t,a){var n=new FormData,o=i+"/upload/examples?resource_id="+a;n.append("file",t);var r=e.post(o,n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}});return r}var i=a.path;return{uploadFile:n,uploadExamplesFile:r,checkExistExamples:o}}]),DInventoryUpload.directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,a,n){var o=e(n.fileModel),r=o.assign;t.parentIvntObj={},a.bind("change",function(){var e=/(zip)/i,n=a[0].files[0].name;t.parentIvntObj.fileName=n;var o=n.substring(n.lastIndexOf(".")+1);e.test(o)?(t.parentIvntObj.fileNameError=!1,t.$apply(function(){r(t,a[0].files[0])})):t.$apply(function(){t.parentIvntObj.fileNameError=!0})})}}}]),DInventoryUpload.directive("fileModelExcel",["$parse",function(e){return{restrict:"A",link:function(t,a,n){var o=e(n.fileModelExcel),r=o.assign;t.parentIvntObj={},a.bind("change",function(){var e=/(xls|xlsx)/i,n=a[0].files[0].name;t.parentIvntObj.fileName=n;var o=n.substring(n.lastIndexOf(".")+1);e.test(o)?(t.parentIvntObj.fileNameError=!1,t.$apply(function(){r(t,a[0].files[0])})):t.$apply(function(){t.parentIvntObj.fileNameError=!0})})}}}]);var DInventory=angular.module("Department.Inventory",["ui.router","ngCookies","cgBusy"]);DInventory.controller("Department.Inventory.Controller.Main",["$cookies","$scope","$q","Department.Inventory.Service.Http",function(e,t,a,n){function o(e){t.promise=n.getDepartInfoResList(e).then(function(e){console.log(e),200==e.data.head.status?(t.infoResourceList=e.data.body[0].results,t.resourceCount=e.data.body[0].count[0].resource_count,t.Paging.totalItems=e.data.body[0].count[0].resource_count):t.infoResourceList=[]})}var r=1,i=2,s=3,l=5,c=11,u=14,d=JSON.parse(e.get("User"));d.dep_id;t.DepartInfoResource={},t.Paging={},t.Paging.currentPage=1,t.Paging.maxSize=5,t.Paging.itemsPerPage=10;var m={};m.limit=10,m.skip=0,n.getSystemDictByCatagory({dict_category:l}).then(function(e){t.secretFlagList=e.data.body}),n.getSystemDictByCatagory({dict_category:r}).then(function(e){t.shareFrequencyList=e.data.body}),n.getSystemDictByCatagory({dict_category:s}).then(function(e){t.shareLevelList=e.data.body}),n.getSystemDictByCatagory({dict_category:c}).then(function(e){t.resourceFormatList=e.data.body}),n.getSystemDictByCatagory({dict_category:i}).then(function(e){t.dataLevelList=e.data.body}),n.getSystemDictByCatagory({dict_category:u}).then(function(e){t.socialOpenList=e.data.body}),t.Paging.pageChanged=function(){m.skip=(t.Paging.currentPage-1)*m.limit,o(m)},o(m),t.getResFormatAll=function(){t.resFormatMainSelection=[],m.re_format=null,m.limit=10,m.skip=0,o(m)},t.getShareLevelAll=function(){t.shareLvMainSelection=[],m.share_level=null,m.limit=10,m.skip=0,o(m)},t.getSocialOpenAll=function(){t.socialOpenMainSelection=[],m.social_open_flag=null,m.limit=10,m.skip=0,o(m)},t.getShareFreqAll=function(){t.shareFreqSelection=[],m.update_period=null,m.limit=10,m.skip=0,o(m)},t.getSecretFlagAll=function(){t.secretFlagMainSelection=[],m.issecret=null,m.limit=10,m.skip=0,o(m)},t.resFormatMainSelection=[],t.getInfoResourceByResFormat=function(e){var a=t.resFormatMainSelection.indexOf(e.id);a>-1?t.resFormatMainSelection=[]:t.resFormatMainSelection=e.id,m.re_format=t.resFormatMainSelection,m.limit=10,m.skip=0,o(m)},t.shareFreqSelection=[],t.getInfoResourceListBySF=function(e){var a=t.shareFreqSelection.indexOf(e.id);a>-1?t.shareFreqSelection.splice(a,1):t.shareFreqSelection.push(e.id),m.update_period=t.shareFreqSelection,m.limit=10,m.skip=0,o(m)},t.shareLvMainSelection=[],t.getInfoResourceListBySl=function(e){var a=t.shareLvMainSelection.indexOf(e.id);a>-1?t.shareLvMainSelection=[]:t.shareLvMainSelection=e.id,m.share_level=t.shareLvMainSelection,m.limit=10,m.skip=0,o(m)},t.socialOpenMainSelection=[],t.getInfoResourceListBySO=function(e){var a=t.socialOpenMainSelection.indexOf(e.dict_code);a>-1?t.socialOpenMainSelection=[]:t.socialOpenMainSelection=e.dict_code,m.social_open_flag=t.socialOpenMainSelection,m.limit=10,m.skip=0,o(m)},t.secretFlagMainSelection=[],t.getInfoResourceListBySecFlag=function(e){var a=t.secretFlagMainSelection.indexOf(e.id);a>-1?t.secretFlagMainSelection=[]:t.secretFlagMainSelection=e.id,m.issecret=t.secretFlagMainSelection,m.limit=10,m.skip=0,o(m)},t.getSpatialAll=function(){t.areaMainSelection=[],m.area_level=null,m.limit=10,m.skip=0,o(m)},t.areaMainSelection=[],t.getInfoResourceListByAP=function(e){var a=t.areaMainSelection.indexOf(e.id);a>-1?t.areaMainSelection.splice(a,1):t.areaMainSelection.push(e.id),m.area_level=t.areaMainSelection,m.limit=10,m.skip=0,o(m)},t.searchDeptInfoResourceByName=function(){m.resource_name=t.DepartInfoResource.resource_name_filter,m.limit=10,m.skip=0,o(m)},t.deleteInfoResource=function(e){var t=confirm("确定删除本条信息资源？删除后将不可恢复。");t&&n.deleteInfoResource({resourceid:e}).then(function(e){200==e.data.head.status?(alert("删除成功！"),o(m)):alert("删除失败")})}}]),DInventory.controller("Department.Inventory.Controller.publish",["$cookies","$scope","$stateParams","$state","$q","$uibModal","Department.Inventory.Service.Component","Department.Inventory.Service.Http",function(e,t,a,n,o,r,i,s){function l(e){s.getInfoItemList({resource_id:e}).then(function(e){200==e.data.head.status&&(t.ResourceItemList=e.data.body,_(t.ResourceItemList).forEach(function(e){var t=[];_(e.config).forEach(function(e){t.push(e.dict_name)}),e.update_period_name=t.toString()}))})}function c(e){s.getInfoItemTreeList({resource_id:e}).then(function(e){200==e.data.head.status&&(t.itemTreeList=e.data.body)})}var u=10,d=12,m=13,p=15,f="250375bd-02f0-11e6-a52a-5cf9dd40ad7e",g="2501e32c-02f0-11e6-a52a-5cf9dd40ad7e",h="aaee8194-2614-11e6-a9e9-507b9d1b58bb",y="ab11fdd4-2614-11e6-a9e9-507b9d1b58bb",v="d8d61ff3-2616-11e6-a9e9-507b9d1b58bb",I=JSON.parse(e.get("User")),S=I.dep_id;t.DEP_NAME=I.dep_name,t.ORG_NAME=I.organization,t.ORG_CODE=I.organization_code,t.InfoResource={},t.InfoResource.alias="",t.InfoResource.rel_category="",t.InfoResource.secret_flag="",t.InfoResource.meter_unit="",t.InfoResource.calculate_method="",t.InfoResource.resource_format_other="",t.InfoResource.share_method_other="",t.InfoResource.social_open_limit="",t.InfoResource.linkman="",t.InfoResource.contact_phone="",t.InfoResource.resource_format_desc="",t.InfoResource.share_method_desc="",t.ResourceItemList=[],t.itemTreeList=[],t.showSelected=function(e){t.parent.selectedItem=e},t.resNameExist=!1,t.checkResName=function(){t.InfoResource.resource_name&&""!=t.InfoResource.resource_name&&s.checkResName({resource_name:t.InfoResource.resource_name}).then(function(e){"true"==e.data.body[0].isexists?t.resNameExist=!0:t.resNameExist=!1})},s.getDepartmentList().then(function(e){t.deptList=e.data.body;_.remove(t.deptList,function(e){return e.id==S})}),s.getSystemDictByCatagory({dict_category:u}).then(function(e){t.resourceCategoryList=e.data.body,t.resourceCategoryRelList=e.data.body}),s.getSystemDictByCatagory({dict_category:d}).then(function(e){t.shareTypeList=e.data.body}),s.getSystemDictByCatagory({dict_category:m}).then(function(e){t.shareMethodList=e.data.body}),s.getSystemDictByCatagory({dict_category:p}).then(function(e){t.itemTypeList=e.data.body}),t.backToUpdate=function(){console.log(t.InfoResource.id),n.go("main.department.inventory.update",{item:t.InfoResource.id},{reload:!0})},t.close=function(e){n.go("main.department.inventory",{},{reload:!0})},t.toUpload=function(){return 0==t.ResourceItemList.length?void alert("您还未添加信息项！"):void n.go("main.department.inventory.uploadExampleData",{ID:t.InfoResource.id},{reload:!0})},t.addInfoResource=function(e){t.submitted=!0;var a={},o=[],r=[];if(console.log(t.resItemAddBtn),t.resNameExist&&(e=!1),0!=t.shareFreqSelection.length||t.resItemAddBtn||(e=!1),t.InfoResource.category==t.InfoResource.rel_category&&(e=!1),t.depShow&&0==t.outputDeptList.length&&(e=!1),e){a.InfoResource=t.InfoResource,_(t.dataLevelSelection).forEach(function(e){var a={};a.InfoResourceId=t.InfoResource.resource_name,a.sys_dict_id=e,o.push(a)}),_(t.shareFreqSelection).forEach(function(e){var a={};a.InfoResourceId=t.InfoResource.resource_name,a.sys_dict_id=e,a.obj_type=1,o.push(a)});var i=_.map(t.outputDeptList,"id");_(i).forEach(function(e){var a={};a.InfoResourceId=t.InfoResource.resource_name,a.apply_dep=e,r.push(a)}),a.InfoResource_RelationConfig=o,a.InfoResourceApplyInfo=r,console.log(a),t.savePromise=s.saveInfoResource(a).then(function(e){console.log(e.data),200==e.data.head.status?t.resItemAddBtn?(t.ResItemListShow=!0,t.InfoResource.id=e.data.body[0].id):(alert("保存成功！"),n.go("main.department.inventory",{},{reload:!0})):alert("保存失败！")})}},console.log(a.item),t.resItemUpdateBtn=!1,a.item&&s.getDepartInfoResList({resource_id:a.item}).then(function(e){t.InfoResource=e.data.body[0].results[0],f==t.InfoResource.share_level&&(t.depShow=!0),h==t.InfoResource.resource_format&&(t.resItemUpdateBtn=!0,t.InfoResource.update_period=""),s.getResourceAreaLevel({resource_id:t.InfoResource.id}).then(function(e){t.dataLevelSelection=e.data.body[0].id}),s.getResourceUpdatePeriod({resource_id:t.InfoResource.id}).then(function(e){t.shareFreqSelection=e.data.body[0].id}),s.getResourceShareDeps({resource_id:t.InfoResource.id}).then(function(e){var a=e.data.body[0].id;a.length>0&&(t.depShow=!0),_(t.deptList).forEach(function(e){_(a).forEach(function(a){e.id==a&&(e.ticked=!0,t.outputDeptList.push(e))})})})}),t.updateInfoResource=function(e){t.submitted=!0;var a={},o=[],r=[];if(t.resNameExist&&(e=!1),0!=t.shareFreqSelection.length||t.resItemUpdateBtn||(e=!1),t.InfoResource.category==t.InfoResource.rel_category&&(e=!1),t.depShow&&0==t.outputDeptList.length&&(e=!1),
e){a.InfoResource=t.InfoResource,_(t.dataLevelSelection).forEach(function(e){var a={};a.InfoResourceId=t.InfoResource.id,a.sys_dict_id=e,o.push(a)}),_(t.shareFreqSelection).forEach(function(e){var a={};a.InfoResourceId=t.InfoResource.id,a.sys_dict_id=e,a.obj_type=1,o.push(a)});var i=_.map(t.outputDeptList,"id");_(i).forEach(function(e){var a={};a.InfoResourceId=t.InfoResource.id,a.apply_dep=e,r.push(a)}),_(t.ResourceItemList).forEach(function(e,a){console.log(a),e.item_ord=a,e.InfoResourceId=t.InfoResource.id,console.log(t.ResourceItemList)}),a.InfoResource_RelationConfig=o,a.InfoResourceApplyInfo=r,t.updatePromise=s.updateInfoResource(a).then(function(e){console.log(e.data),200==e.data.head.status?t.resItemUpdateBtn?(l(t.InfoResource.id),c(t.InfoResource.id),t.ResItemListShow=!0):(alert("保存成功！"),n.go("main.department.inventory",{},{reload:!0})):alert("保存失败")})}},t.addResourceItem=function(e){console.log(t.InfoResource.id),t.shareFreqEmpty=!1,t.Modal={},t.itemAdded=!1,t.ResourceItem={},t.ResourceItem.meter_unit="",t.ResourceItem.calculate_method="",t.ResourceItem.field_standard="",t.ResourceItem.shareFreqItemSelection=[],t.ResourceItem.shareFreqItemObjSelection=[],t.parent={},t.parent.itemNameExist=!1,t.parent.childParentConflict=!1,t.data={},t.ResourceItem.item_type=t.itemTypeList[0].id,t.ResourceItem.secret_flag=t.secretFlagList[0].id,t.parent.selectedItem=void 0,t.ResourceItemConfigList=[];var a={};t.checkItemName=function(){t.ResourceItem.item_name&&""!=t.ResourceItem.item_name&&(console.log(t.ResourceItem),console.log(t.ResourceItemList),t.parent.itemNameExist=!1,_(t.ResourceItemList).forEach(function(e){t.ResourceItem.item_name==e.item_name&&t.ResourceItem!==e&&(t.parent.itemNameExist=!0)}),t.parent.itemNameExist||s.checkItemName({item_name:t.ResourceItem.item_name,info_resource_id:t.InfoResource.id}).then(function(e){"true"==e.data.body[0].isexists?t.parent.itemNameExist=!0:t.parent.itemNameExist=!1}))},t.opts={},t.parent.itemTreeList=t.itemTreeList,i.popModal(t,"Department.Inventory.Controller.publish","新增","item-add-modal").result.then(function(e){t.itemAdded=!1,console.log(t.parent.selectedItem),t.ResourceItem.parent_id=t.parent.selectedItem?t.parent.selectedItem.item_id:"";_(t.ResourceItem.shareFreqItemObjSelection).forEach(function(e){var a={};a.InfoItemId=t.ResourceItem.item_name,a.sys_dict_id=e.id,a.parent_id=t.ResourceItem.parent_id,t.ResourceItemConfigList.push(a)}),t.ResourceItem.resource_id=t.InfoResource.id,a.InfoItem=t.ResourceItem,a.InfoItem_RelationConfig=t.ResourceItemConfigList,s.addInfoItem(a).then(function(e){200==e.data.head.status?(alert("保存成功！"),l(t.InfoResource.id),c(t.InfoResource.id),console.log(t.itemTreeList)):alert("保存失败！")})})},t.updateItem=function(e){t.InfoItem=null,t.ResourceItemConfigList=[],s.getInfoItemById({info_item_id:e}).then(function(e){if(200!=e.data.head.status)return void alert("查询出错！");t.InfoItem=e.data.body[0],t.Modal={},t.itemUpdated=!1,t.ResourceItem=angular.copy(t.InfoItem),t.ResourceItem.shareFreqItemSelection=_.map(t.InfoItem.config,"id"),t.ResourceItem.shareFreqItemObjSelection=t.InfoItem.config,t.shareFreqEmpty=!1,t.parent={},t.parent.itemNameExist=!1,t.parent.selectedItem={},t.parent.itemTreeList=angular.copy(t.itemTreeList);console.log(t.InfoItem),console.log(t.ResourceItem.shareFreqItemSelection);var a={};t.parent.selectedItem.item_name=t.InfoItem.parent_id,t.parent.selectedItem.item_id=t.InfoItem.parent_item_id,t.checkItemName=function(){t.ResourceItem.item_name&&""!=t.ResourceItem.item_name&&(t.parent.itemNameExist=!1,_(t.ResourceItemList).forEach(function(e){t.ResourceItem.item_name==e.item_name&&t.ResourceItem!==e&&(t.parent.itemNameExist=!0)}),t.parent.itemNameExist||s.checkItemName({item_name:t.ResourceItem.item_name,info_resource_id:t.InfoResource.id}).then(function(e){"true"==e.data.body[0].isexists?t.parent.itemNameExist=!0:t.parent.itemNameExist=!1}))},t.opts={isSelectable:function(e){var a=e.parents?e.parents:"";return e.item_id!==t.ResourceItem.id&&a.indexOf(t.ResourceItem.id)<0}},i.popModal(t,"Department.Inventory.Controller.publish","修改","item-add-modal").result.then(function(e){t.itemUpdated=!1;console.log(t.parent.selectedItem),t.ResourceItem.parent_id=t.parent.selectedItem?t.parent.selectedItem.item_id:"",_(t.ResourceItem.shareFreqItemObjSelection).forEach(function(e){var a={};a.InfoItemId=t.ResourceItem.id,a.sys_dict_id=e.id,a.parent_id=t.ResourceItem.parent_id,t.ResourceItemConfigList.push(a)}),t.ResourceItem.resource_id=t.InfoResource.id,a.InfoItem=t.ResourceItem,a.InfoItem_RelationConfig=t.ResourceItemConfigList,s.updateInfoItem(a).then(function(e){200==e.data.head.status?(alert("保存成功！"),l(t.InfoResource.id),c(t.InfoResource.id)):alert("保存失败！")})})})},t.deleteItem=function(e,a){if("0"==a)return void alert("该信息项包含子信息项，请先删除其子信息项！");var n=confirm("确定删除本条信息项？");console.log(e),n&&e&&s.deleteInfoItem({id:e}).then(function(e){200==e.data.head.status?(alert("删除成功！"),l(t.InfoResource.id),c(t.InfoResource.id)):alert("删除失败！")})},t.depShow=!1,t.showHideDeps=function(e){g!=t.InfoResource.share_level?(f==t.InfoResource.share_level?(t.depShow=!0,t.socialOpenFlag=!1):(t.depShow=!1,t.socialOpenFlag=!0,t.outputDeptList=[]),t.InfoResource.social_open_flag=0):(t.InfoResource.social_open_flag=1,t.outputDeptList=[])},t.shareMethodOtherShow=!1,t.showHideShareMethodOther=function(){v==t.InfoResource.share_method?t.shareMethodOtherShow=!0:t.shareMethodOtherShow=!1},t.resItemAddBtn=!1,t.resFormatOtherShow=!1,t.showHideResAddBtn=function(){t.resFormatOtherShow=!1,h==t.InfoResource.resource_format?(a.item?t.resItemUpdateBtn=!0:t.resItemAddBtn=!0,t.resFormatOtherShow=!1,t.shareFreqSelection=[],t.InfoResource.secret_flag="",t.InfoResource.meter_unit="",t.InfoResource.calculate_method=""):y==t.InfoResource.resource_format?(t.resFormatOtherShow=!0,t.resItemAddBtn=!1,t.resItemUpdateBtn=!1):(t.resItemAddBtn=!1,t.resFormatOtherShow=!1,t.resItemUpdateBtn=!1)},t.dataLevelSelection=[],t.toggleDataLevelSelection=function(e){var a=t.dataLevelSelection.indexOf(e.id);a>-1?t.dataLevelSelection.splice(a,1):t.dataLevelSelection.push(e.id)},t.shareFreqSelection=[],t.toggleShareFreqSelection=function(e){var a=t.shareFreqSelection.indexOf(e.id);a>-1?t.shareFreqSelection.splice(a,1):t.shareFreqSelection.push(e.id)},t.toggleShareFreqItemSelection=function(e){var a=t.ResourceItem.shareFreqItemSelection.indexOf(e.id);console.log(a),a>-1?(t.ResourceItem.shareFreqItemSelection.splice(a,1),t.ResourceItem.shareFreqItemObjSelection.splice(a,1)):(t.ResourceItem.shareFreqItemSelection.push(e.id),t.ResourceItem.shareFreqItemObjSelection.push(e)),console.log(t.ResourceItem.shareFreqItemObjSelection)}}]),DInventory.factory("Department.Inventory.Service.Http",["$http","$q","API",function(e,t,a){function n(){return e.get(R+"/sys_dep")}function o(t){return e.get(R+"/info_resource_list",{params:t})}function r(t){return e.get(R+"/data_quota_detail",{params:t})}function i(t){return e.post(R+"/info_resource",{data:t})}function s(t){return e.put(R+"/info_resource",{data:t})}function l(t){return e.get(R+"/allitem_detail",{params:t})}function c(t){return e.get(R+"/allinfo_item_detail",{params:t})}function u(t){return e.get(R+"/sys_dict",{params:t})}function d(t){return e["delete"](R+"/info_resource",{data:t})}function m(t){return e.get(R+"/resource_area_level",{params:t})}function p(t){return e.get(R+"/resource_update_period",{params:t})}function f(t){return e.get(R+"/resource_share_dep",{params:t})}function g(t){return e.get(R+"/info_item",{params:t})}function h(t){return e.post(R+"/info_item",{data:t})}function y(t){return e.put(R+"/info_item",{data:t})}function v(t){return e["delete"](R+"/info_item",{data:t})}function _(t){return e.get(R+"/item_update_period",{params:t})}function I(t){return e.get(R+"/info_resource_name",{params:t})}function S(t){return e.get(R+"/info_item_name",{params:t})}function D(t,a){var n=new FormData,o=R+"/upload/excel?data_quota_id="+a;n.append("file",t);var r=e.post(o,n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}});return r}var R=a.path;return{saveInfoResource:i,getDepartmentList:n,getDepartInfoResList:o,getInfoResourceDetail:r,getSystemDictByCatagory:u,deleteInfoResource:d,updateInfoResource:s,getInfoItemList:l,getInfoItemTreeList:c,getResourceAreaLevel:m,getResourceUpdatePeriod:p,getResourceShareDeps:f,addInfoItem:h,updateInfoItem:y,deleteInfoItem:v,getItemUpdatePeriod:_,checkResName:I,checkItemName:S,uploadFile:D,getInfoItemById:g}}]),DInventory.service("Department.Inventory.Service.Component",["$uibModal","$state",function(e,t){function a(e,t){e.Alerts=[{type:t.type,message:t.message,timeout:1200}],e.CloseAlert=function(t){e.Alerts.splice(t,1)}}function n(t,a,n,o){t.Modal.type=n;var r=e.open({animation:!0,backdrop:"static",templateUrl:o+".html",controller:a,size:"lg",scope:t});return t.Modal.confirm=function(){return console.log(t.parent.itemNameExist),0==t.ResourceItem.shareFreqItemSelection.length?void(t.shareFreqEmpty=!0):void(t.parent.itemNameExist||r.close(t.Modal))},t.Modal.cancel=function(){r.dismiss()},r}return{popAlert:a,popModal:n}}]);var Department=angular.module("Department",["ui.router"]);Department.controller("Department.Controller.Main",["$cookies","$scope","$q","Department.Service.Http","$sce","$state",function(e,t,a,n,o,r){function i(){t.depSelect.show=!1,t.followDeptList=t.parentObj.outputAllDeptList;var e=[];_(t.followDeptList).forEach(function(t){var a={};a.follow_dep_id=t.dep_id,e.push(a)}),n.followDepts({userdep:e}).then(function(e){})}function s(){t.mainAuditPromise=n.getAuditList(y).then(function(e){t.toAuditList=e.data.body[0].results,t.auditTotal=e.data.body[0].count})}function l(){v.response_dep_id=u,console.log(v),t.mainReqPromise=n.getDepartmentRequirementList(v).then(function(e){t.requireToConfirmList=e.data.body[0].results,t.reqTotal=e.data.body[0].count})}var c=JSON.parse(e.get("User"));console.log(c);var u=c.dep_id,d=(c.username,1),m=2,p=3,f=5,g=11,h=14,y={};y.limit=5,y.skip=0;var v={};v.limit=5,v.skip=0,t.depSelect={},t.followDeptList=[],t.parentObj={},s(),l(),n.getSystemDictByCatagory({dict_category:f}).then(function(e){t.secretFlagList=e.data.body}),n.getSystemDictByCatagory({dict_category:d}).then(function(e){t.shareFrequencyList=e.data.body}),n.getSystemDictByCatagory({dict_category:p}).then(function(e){t.shareLevelList=e.data.body}),n.getSystemDictByCatagory({dict_category:g}).then(function(e){t.resourceFormatList=e.data.body}),n.getSystemDictByCatagory({dict_category:m}).then(function(e){t.dataLevelList=e.data.body}),n.getSystemDictByCatagory({dict_category:h}).then(function(e){t.socialOpenList=e.data.body}),n.getDepDataQuotaTotal().then(function(e){t.Count=e.data.body[0]}),t.auditMore=function(){r.go("main.department.audit",{},{reload:!0})},t.reqMore=function(){r.go("main.department.requirementConfirm",{},{reload:!0})},n.getFollowDepList().then(function(e){t.parentObj.outputAllDeptList=e.data.body,t.followDeptList=_.uniq(t.parentObj.outputAllDeptList),n.getDepartmentFollowList().then(function(e){t.parentObj.deptAllList=_.remove(e.data.body,function(e){return e.dep_id!=u}),t.parentObj.outputDeptList=[],_(t.parentObj.deptAllList).forEach(function(e){e.icon="<img  src=styles/images/bureau/"+e.dep_en_name+" />",_(t.parentObj.outputAllDeptList).forEach(function(a){e.dep_id==a.dep_id&&(e.ticked=!0,t.parentObj.outputDeptList.push(e))})}),t.$broadcast("someEvent",t.parentObj.outputDeptList)})}),t.openFn=function(){t.parentObj.outputAllDeptList=t.parentObj.outputDeptList,console.log(t.parentObj.outputAllDeptList)},t.followDep=function(){i()}}]),Department.factory("Department.Service.Http",["$http","$q","API",function(e,t,a){function n(){return e.get(u+"/follow_sys_dep")}function o(){return e.get(u+"/depquota/summary")}function r(t){return e.get(u+"/sys_dict",{params:t})}function i(t){return e.get(u+"/depresource/wait_audit",{params:t})}function s(t){return e.get(u+"/data_requiement",{params:t})}function l(){return e.get(u+"/followed_user_dep")}function c(t){return e.post(u+"/user_dep_batch",{data:t})}var u=a.path;return{getSystemDictByCatagory:r,getAuditList:i,getDepartmentRequirementList:s,getDepartmentFollowList:n,getDepDataQuotaTotal:o,followDepts:c,getFollowDepList:l}}]);var DepartmentReq=angular.module("Department.Requirement",["ui.router"]);DepartmentReq.controller("Department.Requirement.Controller.Main",["$cookies","$scope","$stateParams","Department.Requirement.Service.Component","Department.Requirement.Service.Http",function(e,t,a,n,o){function r(){d.dep_id=s,d.username=l,t.reqPromise=o.getDepartmentRequirementList(d).then(function(e){t.requirementList=e.data.body[0].results,t.Paging.totalItems=e.data.body[0].count})}var i=JSON.parse(e.get("User")),s=i.dep_id,l=i.username,c=1,u=2;t.DeptRequirement={},t.Paging={},t.Paging.currentPage=1,t.Paging.maxSize=5,t.Paging.itemsPerPage=10;var d={};d.limit=10,d.skip=0,t.Paging.pageChanged=function(){d.skip=(t.Paging.currentPage-1)*d.limit,r(d)},r(),o.getDepartmentList().then(function(e){t.deptList=e.data.body;_.remove(t.deptList,function(e){return e.id==s})}),o.getSystemDictByCatagory({dict_category:c}).then(function(e){t.shareFrequencyList=e.data.body}),o.getSystemDictByCatagory({dict_category:u}).then(function(e){t.dataLevelList=e.data.body}),t.toggleDataLevelReqSelection=function(e){var a=t.dataLevelReqSelection.indexOf(e.id);a>-1?t.dataLevelReqSelection.splice(a,1):t.dataLevelReqSelection.push(e.id)},t.toggleShareFreqSelection=function(e){var a=t.shareFreqSelection.indexOf(e.id);a>-1?t.shareFreqSelection.splice(a,1):t.shareFreqSelection.push(e.id)},t.publishReq=function(){t.Modal={},t.Modal.DepRequirment={};var e={},a=[];t.reqParent={},t.reqParent.outputDeptList=[],t.shareFreqSelection=[],t.dataLevelReqSelection=[],t.error=!1,t.submitted=!1,n.popModal(t,"发布","add-req-modal").result.then(function(){_(t.dataLevelReqSelection).forEach(function(e){var n={};n.datarequiementId=t.Modal.DepRequirment.requiement_name,n.sys_dict_id=e,n.obj_type=2,a.push(n)}),_(t.shareFreqSelection).forEach(function(e){var n={};n.datarequiementId=t.Modal.DepRequirment.requiement_name,n.sys_dict_id=e,n.obj_type=2,a.push(n)});var n=_.map(t.reqParent.outputDeptList,"id");console.log(n),t.Modal.DepRequirment.response_dep_id=n[0],e.dataRequiement=t.Modal.DepRequirment,e.dataRelationConfig=a,o.publishRequirement(e).then(function(e){200==e.data.head.status?alert("发布成功"):alert("发布失败"),r()})})},t.searchDeptReqByName=function(){d.requiement_name=t.DeptRequirement.req_name_filter,d.limit=10,d.skip=0,r()},t.deleteReq=function(e){var t=confirm("确定删除本条需求？删除后将不可恢复。");t&&o.deleteRequirement({requiement_id:e}).then(function(e){200==e.data.head.status?(alert("删除成功！"),r()):alert("删除失败！")})},t.updateReq=function(e){t.Modal={},t.Modal.DepRequirment=e;var a={},i=[];t.reqParent={},t.reqParent.outputDeptList=[],t.shareFreqSelection=[],t.dataLevelReqSelection=[],_(t.deptList).forEach(function(a){e.response_dep_id==a.id&&(a.ticked=!0,t.reqParent.outputDeptList.push(a))}),o.getReqUpdatePeriod({requiement_id:e.id}).then(function(e){t.shareFreqSelection=e.data.body[0].id}),o.getReqAreaLevel({requiement_id:e.id}).then(function(e){t.dataLevelReqSelection=e.data.body[0].id}),t.error=!1,n.popModal(t,"修改","add-req-modal").result.then(function(){_(t.dataLevelReqSelection).forEach(function(e){var a={};a.datarequiementId=t.Modal.DepRequirment.id,a.sys_dict_id=e,a.obj_type=2,i.push(a)}),_(t.shareFreqSelection).forEach(function(e){var a={};a.datarequiementId=t.Modal.DepRequirment.id,a.sys_dict_id=e,a.obj_type=2,i.push(a)});var e=_.map(t.reqParent.outputDeptList,"id");t.Modal.DepRequirment.response_dep_id=e[0],a.dataRequiement=t.Modal.DepRequirment,a.dataRelationConfig=i,o.updateRequirementInfo(a).then(function(e){200==e.data.head.status?alert("修改成功"):alert("修改失败"),r()})})},t.filterByConfirmStatus=function(e){d.requiement_status=e,r()}}]),DepartmentReq.controller("Department.Requirement.Controller.confirm",["$cookies","$scope","$stateParams","Department.Requirement.Service.Http","Department.Requirement.Service.Component",function(e,t,a,n,o){function r(){u.response_dep_id=c,t.reqConfirmPromise=n.getDepartmentRequirementList(u).then(function(e){t.requirementConfirmList=e.data.body[0].results,t.Paging.totalItems=e.data.body[0].count})}function i(){n.getDeptInfoResourceList(d).then(function(e){console.log(e),200==e.data.head.status?(t.depInfoResourceList=e.data.body[0].results,t.ModalPaging.totalItems=e.data.body[0].count):t.depInfoResourceList=[]})}var s=11;t.closeShow=!1,t.showIndex=-1,t.resParent={},t.resParent.dropListShow=!1,t.Modal={},t.DeptRequirementConfirm={};var l=JSON.parse(e.get("User")),c=l.dep_id;l.username;t.DeptRequirement={},t.Paging={},t.Paging.maxSize=5,t.Paging.itemsPerPage=10,t.Paging.currentPage=1,t.ModalPaging={},t.ModalPaging.currentPage=1,t.ModalPaging.maxSize=5,t.ModalPaging.itemsPerPage=10;var u={};u.limit=10,u.skip=0;var d={};d.limit=10,d.skip=0,t.checkedResourceName="",t.Paging.pageChanged=function(){u.skip=(t.Paging.currentPage-1)*u.limit,r(u)},t.ModalPaging.pageChanged=function(){d.skip=(t.ModalPaging.currentPage-1)*d.limit,n.getDeptInfoResourceList(d).then(function(e){console.log(e),t.depInfoResourceList=e.data.body[0].results,t.ModalPaging.totalItems=e.data.body[0].count})},r(),i(),t.searchDeptReqConfirmByName=function(){u.requiement_name=t.DeptRequirementConfirm.req_name_filter,u.limit=10,u.skip=0,r()},n.getSystemDictByCatagory({dict_category:s}).then(function(e){t.resourceFormatList=e.data.body}),t.togglResourceList=function(){t.resParent.dropListShow?t.resParent.dropListShow=!1:t.resParent.dropListShow=!0},t.resFormatMainSelection=[],t.getInfoResourceByResFormat=function(e){var a=t.resFormatMainSelection.indexOf(e.id);a>-1?t.resFormatMainSelection=[]:t.resFormatMainSelection=e.id,d.resource_format=t.resFormatMainSelection,d.limit=10,d.skip=0,i(d)},t.getResFormatAll=function(){t.resFormatMainSelection=[],d.resource_format=null,d.limit=10,d.skip=0,i(d)},t.openItems=function(e,a){t.collapseIndex=e,t.closeShow=!0,t.showIndex=e,t.InfoItems=[],n.getInfoItemList({resource_id:a}).then(function(e){0==e.data.body.length?t.InfoItemShow=!1:(t.InfoItemShow=!0,t.InfoItems=e.data.body,_(t.InfoItems).forEach(function(e){var t=[];_(e.config).forEach(function(e){t.push(e.dict_name)}),e.update_period_name=t.toString()}))})},t.closeItems=function(e){t.collapseIndex=-1,t.closeShow=!1,t.InfoItems=[]},t.resourceSelection=[],t.toggleResourceSelection=function(e,a){var n=t.resourceSelection.indexOf(e);n>-1?(t.resourceSelection=[],t.checkedResourceName=""):(t.resourceSelection=e,t.resource_id=e,t.resourceItemSelection=[],t.checkedResourceName='已选中资源 "'+a+'"'),console.log(t.resourceItemSelection)},t.resourceItemSelection=[],t.toggleResItemSelection=function(e,a,n){t.resource_id!=e&&(t.resourceItemSelection=[],t.resource_id=e);var o=t.resourceItemSelection.indexOf(a.id);if(o>-1){t.resourceItemSelection.splice(o,1);var r=t.resourceItemSelection.length;console.log(r),0==r?t.checkedResourceName="":t.checkedResourceName='已选中资源 "'+n+'"下的'+r+"条信息项"}else{t.resourceItemSelection.push(a.id);var r=t.resourceItemSelection.length;t.checkedResourceName='已选中资源 "'+n+'"下的'+r+"条信息项",t.resourceSelection=[]}console.log(t.resourceItemSelection)},t.saveChooseResource=function(){console.log(t.resourceItemSelection),console.log(t.resourceSelection),0==t.resourceItemSelection.length&&0==t.resourceSelection.length?t.errorMsg="您未选中任何资源。":(t.resParent.dropListShow=!1,t.errorMsg="")},t.toConfirm=function(e){t.Modal.ReqDetail=e,t.Modal.ReqResponse={},t.resourceItemSelection=[],t.resourceSelection=[],t.resource_id=null,t.closeShow=!1,t.showIndex=-1,t.collapseIndex=-1,0==t.depInfoResourceList.length&&(t.Modal.ReqResponse.resource_id="",t.errorMsg="本部门还未发布任何信息资源",t.dataQuotaIdNull=!0),o.popModalConfirm(t,"","confirm-req-modal").result.then(function(){t.Modal.ReqResponse.resource_id=t.resource_id,console.log(t.Modal.ReqResponse),console.log(t.resourceItemSelection),t.Modal.ReqResponse.requiement_id=e.id,n.updateRequirement(t.Modal.ReqResponse).then(function(a){if(200==a.data.head.status)if(1==t.Modal.ReqResponse.status){var o=[];if(0==t.resourceItemSelection.length){var i={};i.requiement_id=e.id,i.resource_id=t.Modal.ReqResponse.resource_id,i.item_id="",o.push(i)}else _(t.resourceItemSelection).forEach(function(a){var n={};n.requiement_id=e.id,n.resource_id=t.Modal.ReqResponse.resource_id,n.item_id=a,o.push(n)});n.saveReqResponse(o).then(function(e){200==e.data.head.status?(alert("保存成功！"),r()):(alert("保存失败！"),r())})}else alert("保存成功！"),r();else alert("保存失败")})})},t.filterByConfirmStatus=function(e){u.requiement_status=e,r()}}]),DepartmentReq.controller("Department.Requirement.Controller.detail",["$scope","$stateParams","Department.Requirement.Service.Http","Department.Requirement.Service.Component",function(e,t,a,n){console.log(t.ID),e.InfoItemShow=!1,e.InfoResourceShow=!1,a.getReqDetail({requiement_id:t.ID}).then(function(n){console.log(n.data.body[0]),e.ReqDetail=n.data.body[0],e.ReqDetail.resource_id&&(a.getDepartInfoResList({resource_id:e.ReqDetail.resource_id}).then(function(t){e.InfoResourceDetail=t.data.body[0].results[0],e.InfoResourceDetail&&(e.InfoResourceShow=!0)}),a.getReqResourceItemList({resource_id:e.ReqDetail.resource_id,requiement_id:t.ID}).then(function(t){0==t.data.body.length?e.InfoItemShow=!1:(e.InfoItemShow=!0,e.InfoItems=t.data.body,_(e.InfoItems).forEach(function(e){var t=[];_(e.config).forEach(function(e){t.push(e.dict_name)}),e.update_period_name=t.toString()}))}))})}]),DepartmentReq.factory("Department.Requirement.Service.Http",["$http","API",function(e,t){function a(t){return e.get(v+"/data_requiement",{params:t})}function n(t){return e.post(v+"/data_requiement",{data:t})}function o(t){return e.put(v+"/data_requiement_ok",{data:t})}function r(t){return e.put(v+"/data_requiement",{data:t})}function i(t){return e.post(v+"/data_requiement_response",{data:t})}function s(t){return e.get(v+"/dep_resource_list",{params:t})}function l(t){return e.get(v+"/data_requiement_detail",{params:t})}function c(t){return e.get(v+"/requirement/requireResponseList",{params:t})}function u(){return e.get(v+"/sys_dep")}function d(t){return e["delete"](v+"/data_requiement",{data:t})}function m(t){return e.get(v+"/sys_dict",{params:t})}function p(t){return e.get(v+"/requiement_update_period",{params:t})}function f(t){return e.get(v+"/requiement_area_level",{params:t})}function g(t){return e.get(v+"/allitem_detail",{params:t})}function h(t){return e.get(v+"/info_resource_list",{params:t})}function y(t){return e.get(v+"/reqResourceItem",{params:t})}var v=t.path;return{getDepartmentRequirementList:a,publishRequirement:n,getReqDetail:l,getResponseList:c,updateRequirement:o,updateRequirementInfo:r,saveReqResponse:i,getDeptInfoResourceList:s,getDepartmentList:u,deleteRequirement:d,getSystemDictByCatagory:m,getReqUpdatePeriod:p,getReqAreaLevel:f,getInfoItemList:g,getDepartInfoResList:h,getReqResourceItemList:y}}]),DepartmentReq.service("Department.Requirement.Service.Component",["$uibModal",function(e){function t(e,t){e.Alerts=[{type:t.type,message:t.message,timeout:1200}],e.CloseAlert=function(t){e.Alerts.splice(t,1)}}function a(t,a,n){t.Modal.type=a;var o=e.open({animation:!0,backdrop:"static",templateUrl:n+".html",scope:t,size:"lg"});return t.Modal.confirm=function(e){console.log(t),0==t.resourceSelection.length&&0==t.resourceItemSelection.length&&1==t.Modal.ReqResponse.status?(t.errorMsg="请选择信息资源！",e=!1):t.errorMsg="",e&&o.close(t.Modal)},t.Modal.cancel=function(){o.dismiss()},o}function n(t,a,n){t.Modal.type=a;var o=e.open({animation:!0,backdrop:"static",templateUrl:n+".html",scope:t,size:"lg"});return t.Modal.confirm=function(e){console.log(t),t.submitted=!0,0==t.reqParent.outputDeptList.length?t.error=!0:0==t.shareFreqSelection.length||o.close(t.Modal)},t.Modal.cancel=function(){o.dismiss()},o}return{popAlert:t,popModal:n,popModalConfirm:a}}]);var DepartmentShare=angular.module("DepartmentShare",["ui.router"]);DepartmentShare.controller("DepartmentShare.Controller.Main",["$scope","DepartmentShare.Service.Http",function(e,t){function a(a){e.sharePromise=t.shareInfoResourceList(a).then(function(t){e.depShareList=t.data.body[0].results,e.resourceCount=t.data.body[0].count[0].resource_count,e.Paging.totalItems=t.data.body[0].count[0].resource_count})}e.DepartInfoResource={},e.Paging={},e.Paging.currentPage=1,e.Paging.maxSize=5,e.Paging.itemsPerPage=10;var n={};n.limit=10,n.skip=0,e.Paging.pageChanged=function(){n.skip=(e.Paging.currentPage-1)*n.limit,a(n)},a(n),e.getResFormatAll=function(){e.resFormatMainSelection=[],n.re_format=null,n.limit=10,n.skip=0,a(n)},e.getShareLevelAll=function(){e.shareLvMainSelection=[],n.share_level=null,n.limit=10,n.skip=0,a(n)},e.getSocialOpenAll=function(){e.socialOpenMainSelection=[],n.social_open_flag=null,n.limit=10,n.skip=0,a(n)},e.getShareFreqAll=function(){e.shareFreqSelection=[],n.update_period=null,n.limit=10,n.skip=0,a(n)},e.getSecretFlagAll=function(){e.secretFlagMainSelection=[],n.issecret=null,n.limit=10,n.skip=0,a(n)},e.resFormatMainSelection=[],e.getInfoResourceByResFormat=function(t){var o=e.shareFreqSelection.indexOf(t.id);o>-1?e.resFormatMainSelection=[]:e.resFormatMainSelection=t.id,n.re_format=e.resFormatMainSelection,n.limit=10,n.skip=0,a(n)},e.shareFreqSelection=[],e.getInfoResourceListBySF=function(t){var o=e.shareFreqSelection.indexOf(t.id);o>-1?e.shareFreqSelection.splice(o,1):e.shareFreqSelection.push(t.id),n.update_period=e.shareFreqSelection,n.limit=10,n.skip=0,a(n)},e.shareLvMainSelection=[],e.getInfoResourceListBySl=function(t){var o=e.shareLvMainSelection.indexOf(t.id);o>-1?e.shareLvMainSelection=[]:e.shareLvMainSelection=t.id,n.share_level=e.shareLvMainSelection,n.limit=10,n.skip=0,a(n)},e.socialOpenMainSelection=[],e.getInfoResourceListBySO=function(t){var o=e.socialOpenMainSelection.indexOf(t.dict_code);o>-1?e.socialOpenMainSelection=[]:e.socialOpenMainSelection=t.dict_code,n.social_open_flag=e.socialOpenMainSelection,n.limit=10,n.skip=0,a(n)},e.secretFlagMainSelection=[],e.getInfoResourceListBySecFlag=function(t){var o=e.secretFlagMainSelection.indexOf(t.id);o>-1?e.secretFlagMainSelection=[]:e.secretFlagMainSelection=t.id,n.issecret=e.secretFlagMainSelection,n.limit=10,n.skip=0,a(n)},e.getSpatialAll=function(){e.areaMainSelection=[],n.area_level=null,n.limit=10,n.skip=0,a(n)},e.areaMainSelection=[],e.getInfoResourceListByAP=function(t){var o=e.areaMainSelection.indexOf(t.id);o>-1?e.areaMainSelection.splice(o,1):e.areaMainSelection.push(t.id),n.area_level=e.areaMainSelection,n.limit=10,n.skip=0,a(n)},e.searchDeptInfoResourceByName=function(){n.resource_name=e.DepartInfoResource.resource_name_filter,n.limit=10,n.skip=0,a(n)};var o=1,r=2,i=3,s=5,l=11,c=14;t.getSystemDictByCatagory({dict_category:s}).then(function(t){e.secretFlagList=t.data.body}),t.getSystemDictByCatagory({dict_category:o}).then(function(t){e.shareFrequencyList=t.data.body}),t.getSystemDictByCatagory({dict_category:i}).then(function(t){e.shareLevelList=t.data.body}),t.getSystemDictByCatagory({dict_category:l}).then(function(t){e.resourceFormatList=t.data.body}),t.getSystemDictByCatagory({dict_category:r}).then(function(t){e.dataLevelList=t.data.body}),t.getSystemDictByCatagory({dict_category:c}).then(function(t){e.socialOpenList=t.data.body})}]),DepartmentShare.controller("DepartmentShare.Controller.detail",["$scope","DepartmentShare.Service.Http","$stateParams","API",function(e,t,a,n){n.path;console.log(a.item),e.InfoItemShow=!1,t.getShareInfoResDetail({resource_id:a.item}).then(function(a){e.InfoResourceDetail=a.data.body[0].results[0],e.InfoResourceDetail&&e.InfoResourceDetail.resource_format_name.indexOf("数据库类")>-1&&t.getInfoItemList({resource_id:e.InfoResourceDetail.id}).then(function(t){0==t.data.body.length?e.InfoItemShow=!1:(e.InfoItemShow=!0,e.InfoItems=t.data.body,_(e.InfoItems).forEach(function(e){var t=[];_(e.config).forEach(function(e){t.push(e.dict_name)}),e.update_period_name=t.toString()}))})}),e.ShareDataExamples=t.getShareResourceExampleDatas({resource_id:a.item}),e.ShareResourceReqByDepTotals=t.getShareResourceReqByDepTotals({resource_id:a.item})}]),DepartmentShare.factory("DepartmentShare.Service.Http",["$http","API",function(e,t){function a(t){return e.get(d+"/share_list",{params:t})}function n(t){return e.get(d+"/data_quota_detail",{params:t})}function o(t){return e.post(d+"/user_dep",{data:t})}function r(t){return e.get(d+"/sys_dict",{params:t})}function i(t){return e["delete"](d+"/user_dep",{data:t})}function s(t){return e.get(d+"/share_resource_detail",{params:t})}function l(t){return e.get(d+"/allitem_detail",{params:t})}function c(t){return e.get(d+"/info_resource_examples",{params:t})}function u(t){return e.get(d+"/info_item_requirementDeps",{params:t})}var d=t.path;return{getSystemDictByCatagory:r,shareInfoResourceList:a,getQuotaDetail:n,followDepartment:o,cancelFollowDepartment:i,getShareInfoResDetail:s,getInfoItemList:l,getShareResourceExampleDatas:c,getShareResourceReqByDepTotals:u}}]),DepartmentShare.directive("wiservShareExampleData",[function(){return{restrict:"AE",template:"<div style='width:500px;height:400px;position:relative;top:20px'></div>",link:function(e,t,a){console.log(e),e.ShareDataExamples.then(function(e){e.data.body&&e.data.body[0]&&e.data.body[0].file_content&&t.html(e.data.body[0].file_content)})}}}]),DepartmentShare.directive("wiservShareReqdepRelationship",[function(){return{restrict:"AE",template:"<div style='width:900px;height:400px;position:relative;top:20px'></div>",link:function(e,t,a){console.log(e),e.ShareResourceReqByDepTotals.then(function(e){if(200==e.data.head.status){var a=e.data.body[0],n=_.size(a.depNames),o=(a.resourceName,a.depNames),r=[{category:0,name:"当前信息资源",value:10,label:"当前信息资源"}],i=[];n&&_(o).forEach(function(e,t){var a={};a.category=1,a.name=e,a.value=2,r.push(a);var n={};n.source="当前信息资源",n.target=e,n.weight=1,i.push(n)});var s=echarts.init(t.find("div")[0]),l={title:{text:"当前信息资源对应的需求部门为"+n+"个",x:"center",y:"top"},tooltip:{trigger:"item",formatter:"{a} : {b}"},legend:{x:"left",data:["需求部门"]},series:[{type:"force",name:"当前信息资源-需求部门",ribbonType:!1,categories:[{name:"当前信息资源"},{name:"需求部门"}],itemStyle:{normal:{label:{show:!0,textStyle:{color:"#333"}},nodeStyle:{brushType:"both",borderColor:"rgba(255,215,0,0.4)",borderWidth:1}},emphasis:{label:{show:!1},nodeStyle:{},linkStyle:{}}},minRadius:15,maxRadius:25,gravity:1.1,scaling:1.1,draggable:!1,linkSymbol:"arrow",steps:10,coolDown:.9,roam:"move",nodes:r,links:i}]};s.setOption(l)}})}}}]);var SystemUser=angular.module("Department.SystemUser",["ui.router"]);SystemUser.controller("Department.SystemUser.Controller.Main",["$scope","$q","Department.SystemUser.Service.Http","Department.SystemUser.Service.Component","$uibModal",function(e,t,a,n,o){function r(){a.getUserList().then(function(t){e.users=t.data.body,e.DepUserTotal=t.data.head.total})}e.Modal={},e.deptList=[],r(),e.addUserModal=function(){e.Modal={},e.sysUser={},n.popModal(e,"添加","add-user-modal").result.then(function(){a.saveUser(e.sysUser).then(function(e){200==e.data.head.status?(alert("添加成功"),r()):alert("添加失败")})})},e.searchUser=function(){var t=e.username;alert(t)},e.updateUser=function(t){t.DEP_NAME=null,e.sysUser=t,n.popModal(e,"修改","add-user-modal").result.then(function(){a.updateUser(e.sysUser).then(function(e){200==e.data.head.status?(alert("修改成功"),r()):alert("修改失败")})})},e.deleteUser=function(e){console.log(e);var t=confirm("确定要删除吗？");t&&a.deleteUser(e).then(function(e){console.log(e.data),200==e.data.head.status?(alert("删除成功"),r()):alert("删除失败！"),r()})}}]),SystemUser.factory("Department.SystemUser.Service.Http",["$http","$q","API",function(e,t,a){function n(){return e.get(c+"/user")}function o(t){return e.get(c+"/user",{params:t})}function r(t){return e.post(c+"/user",{data:t})}function i(){return e.get(c+"/dep/")}function s(t){return e.put(c+"/user/",{data:t})}function l(t){return e["delete"](c+"/user",{data:{ID:t.ID}})}var c=a.path;return{getUserList:n,saveUser:r,getDepartmentList:i,updateUser:s,deleteUser:l,
getUser:o}}]),SystemUser.service("Department.SystemUser.Service.Component",["$uibModal",function(e){function t(e,t){e.Alerts=[{type:t.type,message:t.message,timeout:1200}],e.CloseAlert=function(t){e.Alerts.splice(t,1)}}function a(t,a,n){t.Modal.type=a;var o=e.open({animation:!0,backdrop:"static",templateUrl:n+".html",scope:t});return t.Modal.confirm=function(e){e&&o.close(t.Modal)},t.Modal.cancel=function(){o.dismiss()},o}return{popAlert:t,popModal:a}}]);
//# sourceMappingURL=app.min.js.map
