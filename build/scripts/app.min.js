"use strict";var app=angular.module("app",["Config","ui.router","ui.bootstrap","treeControl","isteven-multi-select","Login","Main","Dashboard","Admin","Admin.User","Admin.Department","Department","DataQuota","DataQuotaList","DataQuotaDetail","Department.Inventory","Department.Audit","Department.Requirement","DepartmentShare"]);app.config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider","$provide",function(e,t,a,n,r){a.html5Mode(!1),n.interceptors.push(["$q",function(e){return{request:function(e){return e.withCredentials=!0,e},requestError:function(e){return response},response:function(e){return e},responseError:function(e){return e}}}]),t.otherwise("/login"),e.state("login",{url:"/login",templateUrl:"views/common/login.html",controller:"Login.Controller.Main"}).state("main",{url:"/main",templateUrl:"views/common/main.html",controller:"Main.Controller.Main"}).state("main.dashboard",{url:"/dashboard",templateUrl:"views/common/dashboard.html",controller:"Dashboard.Controller.Main"}).state("main.admin",{url:"/admin",templateUrl:"views/admin/main.html",controller:"Admin.Controller.Main"}).state("main.admin.department",{url:"/dashboard",templateUrl:"views/admin/department.html",controller:"Admin.Department.Controller.Main"}).state("main.admin.user",{url:"/user",templateUrl:"views/admin/user.html",controller:"Admin.User.Controller.Main"}).state("main.data-quota",{url:"/data-quota",templateUrl:"views/data-quota/main.html",controller:"DataQuota.Controller.Main"}).state("main.data-quota.list",{url:"/list/:quota_dep_id/:dep_name",templateUrl:"views/data-quota/list.html",controller:"DataQuotaList.Controller.Main"}).state("main.data-quota.detail",{url:"/detail/:data_quota_id",templateUrl:"views/data-quota/detail.html",controller:"DataQuotaDetail.Controller.Main"}).state("main.department",{url:"/department",cache:"false",reload:!0,templateUrl:"views/department/main.html",controller:"Department.Controller.Main"}).state("main.department.inventory",{url:"/inventory",cache:"false",templateUrl:"views/department/inventory.html",controller:"Department.Inventory.Controller.Main"}).state("main.department.inventory.publish",{url:"/publish",templateUrl:"views/department/inventory-publish.html",controller:"Department.Inventory.Controller.publish"}).state("main.department.inventory.detail",{url:"/detail?ID",cache:"false",templateUrl:"views/department/inventory-detail.html",controller:"Department.Inventory.Controller.detail"}).state("main.department.inventory.upload",{url:"/upload?ID",cache:"false",templateUrl:"views/department/inventory-upload.html",controller:"Department.Inventory.Controller.upload"}).state("main.department.share",{url:"/share",templateUrl:"views/department/share.html",controller:"DepartmentShare.Controller.Main"}).state("main.department.share.detail",{url:"/detail?ID",templateUrl:"views/department/share-detail.html",controller:"DepartmentShare.Controller.detail"}).state("main.department.requirementConfirm",{url:"/requirement-confirm",templateUrl:"views/department/requirement-confirm.html",controller:"Department.Requirement.Controller.confirm"}).state("main.department.requirement",{url:"/requirement",templateUrl:"views/department/requirement.html",controller:"Department.Requirement.Controller.Main"}).state("main.department.requirement.publish",{url:"/publish",templateUrl:"views/department/requirement-publish.html"}).state("main.department.requirement.detail",{url:"/detail?ID",templateUrl:"views/department/requirement-detail.html",controller:"Department.Requirement.Controller.detail"}).state("main.department.audit",{url:"/audit",cache:"false",templateUrl:"views/department/audit.html",controller:"Department.Audit.Controller.Main"}).state("main.department.audit.info",{url:"/info/:AUDITID/:DATAQUOTAID/:APPLYDEPNAME/:APPLYTIME",templateUrl:"views/department/audit-info.html",controller:"Department.Audit.Controller.info"})}]);var Config=angular.module("Config",[]);Config.constant("API",{path:"http://172.16.1.78:8080/api"});var AdminDepartment=angular.module("Admin.Department",["ui.router"]);AdminDepartment.controller("Admin.Department.Controller.Main",["$rootScope","$scope","$stateParams","AdminDepartment.Service.Http","AdminDepartment.Service.Component","$uibModal","$state",function(e,t,a,n,r,o,i){function d(e){n.getDepartmentList(e).then(function(e){t.AdminDepartments=e.data.body})}function l(){n.getDepTotal({}).then(function(e){t.depTotal=e.data.body[0].number,t.Paging.totalItems=t.depTotal})}t.Modal={},t.previousDepNames=[],t.areaNames=[],t.Paging={},t.Paging.maxSize=5,t.Paging.itemsPerPage=10;var s={};s.limit=10,s.skip=0,t.Paging.pageChanged=function(){s.skip=(t.Paging.currentPage-1)*s.limit,d(s)},d(s),l(),n.getDepartmentList().then(function(e){t.AllDepartments=e.data.body}),n.getSysDict({dict_category:"7"}).then(function(e){t.types=e.data.body}),n.getSysDict({dict_category:"9"}).then(function(e){t.areaNames=e.data.body}),t.placeholder={},t.placeholder.dep_sn="必填",t.placeholder.order_by="必填",t.placeholder.dep_name="必填",t.placeholder.dep_short_name="必填",t.placeholder.dep_en_name="必填",t.placeholder.contacts="必填",t.placeholder.contact_phone="必填",t.addDepartmentModal=function(){t.Modal={},t.department={},t.department.dep_en_name="anquanting.png",t.department.parent_id="0",t.department.area_code="c9cf130a-1e2f-11e6-ac02-507b9d1b58bb",t.department.dep_type="aa7772bb-10de-11e6-9b44-507b9d1b58bb";var e=r.popModal(t,"添加","add-department-modal");e.opened.then(function(){t.Modal.TypeArea=function(){if("0"!=t.department.parent_id){var e=_.findIndex(t.AllDepartments,function(e){return e.id==t.department.parent_id});t.department1=t.AllDepartments[e]}},t.Modal.validDepName=function(e){t.validDepName=!1,t.placeholder.dep_name="必填",n.getDepartmentList().then(function(a){for(var n=a.data.body,r=0;r<n.length;r++)n[r].dep_name===e&&(t.validDepName=!0,t.placeholder.dep_name="该部门已存在,请重新输入",t.department.dep_name="")})},t.Modal.validPhone=function(){t.placeholder.contact_phone="必填",t.validPhone=!1;var e=/^((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)/;e.test(t.department.contact_phone)||null==t.department.contact_phone||(t.validPhone=!0,t.placeholder.contact_phone="电话格式不对",t.department.contact_phone="")}}),e.result.then(function(){n.saveDepartment(t.department).then(function(e){200==e.data.head.status?alert("添加成功"):alert("添加失败"),s.limit=10,s.skip=0,t.Paging.currentPage=0,d(s),l()})})},t.updateDepartment=function(e){t.department=e,t.department.parent_id="0",t.department.area_code="c9cf130a-1e2f-11e6-ac02-507b9d1b58bb",t.department.dep_type="aa7772bb-10de-11e6-9b44-507b9d1b58bb",t.department.dep_en_name="anquanting.png",_.remove(t.AllDepartments,function(t){return t.dep_name==e.dep_name});var a=r.popModal(t,"修改","add-department-modal");a.opened.then(function(){t.Modal.TypeArea=function(){if("0"!=t.department.parent_id){var e=_.findIndex(t.AllDepartments,function(e){return e.id==t.department.parent_id});t.department1=t.AllDepartments[e]}},t.Modal.validDepName=function(e){t.validDepName=!1,t.placeholder.dep_name="必填",n.getDepartmentList().then(function(a){for(var n=a.data.body,r=0;r<n.length;r++)n[r].dep_name===e&&(t.validDepName=!0,t.placeholder.dep_name="该部门已存在,请重新输入",t.department.dep_name="")})},t.Modal.validPhone=function(){t.placeholder.contact_phone="必填",t.validPhone=!1;var e=/^((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)/;e.test(t.department.contact_phone)||null==t.department.contact_phone||(t.validPhone=!0,t.placeholder.contact_phone="电话格式不对",t.department.contact_phone="")}}),a.result.then(function(){n.updateDepartment(t.department).then(function(e){s.limit=10,s.skip=0,t.Paging.currentPage=0,200==e.data.head.status?alert("修改成功"):alert("修改失败"),d(s)})})},t.deleteDepartment=function(e){var a=confirm("确定要删除吗？");a&&n.deleteDepartment(e).then(function(e){s.limit=10,s.skip=0,t.Paging.currentPage=0,200==e.data.head.status?alert("删除成功"):alert("删除失败！"),i.go("main.admin.department",{},{reload:!0})})},t.searchDepartment=function(){s.limit=10,s.skip=0,s.sysdepname=t.dep_name,null==t.dep_name?(l(),d(s)):n.getDepartmentList(s).then(function(e){e.data.head.total>=1?(t.AdminDepartments=e.data.body,t.depTotal=e.data.head.total,t.Paging.totalItems=t.depTotal):(alert("系统没有查到'"+t.dep_name+"'这个部门，请重新输入"),t.dep_name="",i.go("main.admin.department",{},{reload:!0}))})}}]),AdminDepartment.factory("AdminDepartment.Service.Http",["$http","API",function(e,t){function a(t){return e.get(l+"/sys_dep",{params:t})}function n(){return e.get(l+"/sys_dep/count")}function r(t){return e.post(l+"/sys_dep",{data:t})}function o(t){return e.get(l+"/sys_dict",{params:t})}function i(t){return e.put(l+"/sys_dep",{data:t})}function d(t){return e["delete"](l+"/sys_dep",{data:{id:t.id}})}var l=t.path;return{getDepartmentList:a,getDepTotal:n,saveDepartment:r,getSysDict:o,updateDepartment:i,deleteDepartment:d}}]),AdminDepartment.service("AdminDepartment.Service.Component",["$uibModal","$state",function(e,t){function a(e,t){e.Alerts=[{type:t.type,message:t.message,timeout:1200}],e.CloseAlert=function(t){e.Alerts.splice(t,1)}}function n(a,n,r){a.Modal.type=n;var o=e.open({animation:!0,backdrop:"static",templateUrl:r+".html",scope:a,size:"md"});return a.Modal.confirm=function(e){e&&o.close(a.Modal)},a.Modal.cancel=function(){o.dismiss(),t.go("main.admin.department",{},{reload:!0})},o}return{popAlert:a,popModal:n}}]);var Admin=angular.module("Admin",["ui.router","ngCookies"]);Admin.controller("Admin.Controller.Main",["$cookies","$scope","$stateParams",function(e,t,a){var n=JSON.parse(e.get("User"));t.depName=n.dep_name,null==t.depName?t.titleName="用户/部门管理":t.titleName="用户管理"}]);var AdminUser=angular.module("Admin.User",["ui.router","ngCookies"]);AdminUser.controller("Admin.User.Controller.Main",["$cookies","$scope","$q","$stateParams","AdminUser.Service.Http","AdminUser.Service.Component","$uibModal","$state",function(e,t,a,n,r,o,i,d){function l(e){r.getUserList(e).then(function(e){t.users=e.data.body})}function s(){r.getUserTotal({dep_id:p}).then(function(e){p?t.UserTotal=e.data.body[0].number:t.UserTotal=e.data.body[0].number-1,t.Paging.totalItems=t.UserTotal})}var u=JSON.parse(e.get("User")),p=u.dep_id,m=u.dep_name;t.Paging={},t.Paging.maxSize=5,t.Paging.itemsPerPage=10;var c={};c.limit=10,c.skip=0,c.dep_id=p,t.Paging.pageChanged=function(){c.skip=(t.Paging.currentPage-1)*c.limit,l(c)},t.Modal={},t.deptList=[],s(),l(c),r.getDepartmentList({dep_name:m}).then(function(e){t.deptList=e.data.body}),t.placeholder={},t.placeholder.name="必填",t.placeholder.password="必填",t.placeholder.password1="必填",t.placeholder.personName="必填",t.placeholder.phone="必填",t.placeholder.email="必填",t.addUserModal=function(){t.Modal={},t.sysUser={};var e=o.popModal(t,"添加","add-user-modal");e.opened.then(function(){t.Modal.validUser=function(e){t.placeholder.name="必填",t.validUser=!1,r.getUserList({dep_id:p}).then(function(a){for(var n=a.data.body,r=0;r<n.length;r++)n[r].username===e&&(t.validUser=!0,t.placeholder.name="用户名已存在,请重新输入",t.sysUser.username="")})},t.Modal.validPword=function(){t.placeholder.password1="必填",t.validPword=!1,t.sysUser.password!=t.sysUser.password1&&null!=t.sysUser.password1&&(t.validPword=!0,t.placeholder.password1="两次输入的密码不同,请重新输入",t.sysUser.password1="")},t.Modal.validPhone=function(){t.placeholder.phone="必填",t.validPhone=!1;var e=/^((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)/;e.test(t.sysUser.phone)||null==t.sysUser.phone||(t.validPhone=!0,t.placeholder.phone="电话格式不对",t.sysUser.phone="")},t.Modal.validEmail=function(e){t.placeholder.email="必填",t.validEmail=!1,e&&(t.validEmail=!0,t.placeholder.email="邮箱格式不对",t.sysUser.email="")}}),e.result.then(function(){r.saveUser(t.sysUser).then(function(e){200==e.data.head.status?alert("添加成功"):alert("保存数据库失败"),c.limit=10,c.skip=0,t.Paging.currentPage=0,l(c),s()})})},t.updateUser=function(e){t.sysUser=e,t.sysUser.password1=0,t.sysUser.password=0;var a=o.popModal(t,"修改","add-user-modal");a.opened.then(function(){t.Modal.validUser=function(e){t.placeholder.name="必填",t.validUser=!1,r.getUserList({dep_id:p}).then(function(a){for(var n=a.data.body,r=0;r<n.length;r++)n[r].username===e&&(t.validUser=!0,t.placeholder.name="用户名已存在,请重新输入",t.sysUser.username="")})},t.Modal.validPhone=function(){t.placeholder.phone="必填",t.validPhone=!1;var e=/^((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)/;e.test(t.sysUser.phone)||null==t.sysUser.phone||(t.validPhone=!0,t.placeholder.phone="电话格式不对",t.sysUser.phone="")},t.Modal.validEmail=function(e){t.placeholder.email="必填",t.validEmail=!1,e&&(t.validEmail=!0,t.placeholder.email="邮箱格式不对",t.sysUser.email="")}}),a.result.then(function(){r.updateUser(t.sysUser).then(function(e){c.limit=10,c.skip=0,t.Paging.currentPage=0,200==e.data.head.status?alert("修改成功"):alert("修改失败"),l(c)})})},t.deleteUser=function(e){var a=confirm("确定要删除吗？");a&&r.deleteUser(e).then(function(e){c.limit=10,c.skip=0,t.Paging.currentPage=0,200==e.data.head.status?(alert("删除成功"),s(),l(c)):alert("删除失败！"),d.go("main.admin.user",{},{reload:!0})})},t.Password=function(e){t.placeholder.password_1="必填",t.placeholder.password_2="必填",t.placeholder.password_3="必填";var a=0;a=e.id,t.Modal.password_pre="",t.Modal.p2="",t.Modal.password="",t.password_1=!1,t.password_2=!1,t.password_3=!1;var n=o.popModal(t,"密码","update-password-modal");n.opened.then(function(){t.Modal.validPword1=function(){t.password_1=!1,t.placeholder.password_1="必填",r.validatePassword({id:a,password:t.Modal.password_pre}).then(function(e){0==e.data.head.total&&(t.password_1=!0,t.placeholder.password_1="原密码不对,请重新输入",t.Modal.password_pre="")})},t.Modal.validPword=function(){t.password_3=!1,t.placeholder.password_3="必填",t.Modal.p2!=t.Modal.password&&(t.password_3=!0,t.placeholder.password_3="两次输入的密码不同,请重新输入",t.Modal.password="")}}),n.result.then(function(){r.UpdatePassword({id:a,password:t.Modal.password}).then(function(e){200==e.data.head.status?alert("修改成功"):alert("修改失败"),c.limit=10,c.skip=0,t.Paging.currentPage=0,l(c),s()})})},t.searchUser=function(){c.limit=10,c.skip=0,c.dep_id=p,c.sysusername=t.username,null==t.username?(s(),l(c)):r.getUserList(c).then(function(e){e.data.head.total>=1?(t.users=e.data.body,t.UserTotal=e.data.head.total,t.Paging.totalItems=t.UserTotal):(alert("系统没有查到'"+t.username+"'这个用户名，请重新输入"),d.go("main.admin.user",{},{reload:!0}))})}}]),AdminUser.factory("AdminUser.Service.Http",["$http","API",function(e,t){function a(t){return e.get(u+"/sys_user",{params:t})}function n(t){return e.get(u+"/sys_user/count",{params:t})}function r(t){return e.get(u+"/sys_dep",{params:t})}function o(t){return e.post(u+"/sys_user",{data:t})}function i(t){return e.put(u+"/sys_user",{data:t})}function d(t){return e["delete"](u+"/sys_user",{data:{id:t.id}})}function l(t){return e.get(u+"/sys_user/password",{params:t})}function s(t){return e.put(u+"/sys_user/password",{data:t})}var u=t.path;return{getUserList:a,saveUser:o,getDepartmentList:r,updateUser:i,deleteUser:d,getUserTotal:n,validatePassword:l,UpdatePassword:s}}]),AdminUser.service("AdminUser.Service.Component",["$uibModal","$state",function(e,t){function a(e,t){e.Alerts=[{type:t.type,message:t.message,timeout:1200}],e.CloseAlert=function(t){e.Alerts.splice(t,1)}}function n(a,n,r){a.Modal.type=n;var o=e.open({animation:!0,backdrop:"static",templateUrl:r+".html",scope:a,size:"md"});return a.Modal.confirm=function(e){e&&o.close(a.Modal)},a.Modal.cancel=function(){o.dismiss(),t.go("main.admin.user",{},{reload:!0})},o}return{popAlert:a,popModal:n}}]);var Dashboard=angular.module("Dashboard",["ui.router","ui.bootstrap"]);Dashboard.controller("Dashboard.Controller.Main",["$scope","Dashboard.Service.Http",function(e,t){t.getDepartments().then(function(t){200==t.data.head.status&&(e.Bureaus=t.data.body)}),e.DataquotaSummary=t.getDataquotaSummary(),e.DataRequirementSummary=t.getDataRequirementSummary(),t.getDataquotaSummary().then(function(t){e.SummaryDataQuota=t.data.body[0]}),t.getDataRequirementSummary().then(function(t){e.SummaryRequirement=t.data.body[0]}),t.getDataQuotaNew({skip:0,limit:7}).then(function(t){200==t.data.head.status&&(e.NewIndicators=t.data.body)}),t.getDataRequirementNew({skip:0,limit:7}).then(function(t){200==t.data.head.status&&(e.Requirements=t.data.body)}),e.select=function(a){e.departmentID={quota_dep_id:a},t.getDataQuota({skip:0,limit:5,dep_name:a}).then(function(t){e.followDepIndicators=t.data.body[0].results})},t.getUserDep().then(function(t){return 200===t.data.head.status&&0!==t.data.body.length?(e.followDeps=t.data.body,t.data.body[0].follow_dep_id):void 0}).then(function(a){t.getDataQuota({skip:0,limit:5,dep_name:a}).then(function(t){e.followDepIndicators=t.data.body[0].results})})}]),Dashboard.factory("Dashboard.Service.Http",["$http","API",function(e,t){function a(t){return e.get(s+"/data_quota/new",{params:t})}function n(t){return e.get(s+"/data_requiement/new",{params:t})}function r(){return e.get(s+"/sys_dep")}function o(){return e.get(s+"/data_quota/summary")}function i(){return e.get(s+"/data_requiement/summary")}function d(t){return e.get(s+"/user_dep",{params:t})}function l(t){return e.get(s+"/data_quota",{params:t})}var s=t.path;return{getDataQuotaNew:a,getDataRequirementNew:n,getDepartments:r,getDataquotaSummary:o,getDataRequirementSummary:i,getUserDep:d,getDataQuota:l}}]),Dashboard.directive("wiservDataQuotaOverviewChart",[function(){return{restrict:"AE",template:"<div style='width:300;height:155px;position:relative;top:-8px'></div>",link:function(e,t,a){e.DataquotaSummary.then(function(e){if(200==e.data.head.status){var a=e.data.body[0],n=echarts.init(t.find("div")[0]),r={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:"清单提供部门",type:"pie",selectedMode:"single",radius:[0,"60%"],label:{normal:{position:"inner",textStyle:{color:"#FFAD38"}}},labelLine:{normal:{show:!1}},data:[{value:a.department_number,name:"清单提供部门"},{value:a.department_number_inc,name:"本月新增",selected:!0}]},{name:"清单总数",type:"pie",radius:["70%","90%"],data:[{value:a.data_quota_number,name:"清单总数"},{value:a.data_quota_number_inc,name:"本月新增",selected:!0}]}]};n.setOption(r)}})}}}]),Dashboard.directive("wiservRequirementOverviewChart",[function(){return{restrict:"AE",template:"<div style='width:300;height:155px;position:relative;top:-8px'></div>",link:function(e,t,a){e.DataRequirementSummary.then(function(e){if(200==e.data.head.status){var a=e.data.body[0],n=echarts.init(t.find("div")[0]),r={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:"需求涉及部门",type:"pie",selectedMode:"single",radius:[0,"60%"],label:{normal:{position:"inner",textStyle:{color:"#FFAD38"}}},labelLine:{normal:{show:!1}},data:[{value:a.department_number,name:"需求涉及部门"},{value:a.department_number_inc,name:"本月新增",selected:!0}]},{name:"需求总数",type:"pie",radius:["70%","90%"],data:[{value:a.requiement_number,name:"需求总数"},{value:a.requiement_number_inc,name:"本月新增",selected:!0}]}]};n.setOption(r)}})}}}]),Dashboard.directive("wiservStatisticChart",[function(){return{restrict:"AE",template:"<div style='width:100%;height:240px;'></div>",link:function(e,t,a){e.QInventoryStatistic.then(function(e){var a=e.data.body[0],n=e.data.body[1],r=e.data.body[2],o=echarts.init(t.find("div")[0]),i={tooltip:{trigger:"axis"},legend:{data:["清单","需求"]},xAxis:[{type:"category",name:"数量",data:a.DEPARTMENT}],yAxis:[{type:"value",name:"单位",min:0,max:30,interval:30,axisLabel:{formatter:"{value} 个"}}],series:[{name:"清单",type:"bar",data:n.INVENTORY},{name:"需求",type:"bar",data:r.REQUIREMENT}]};o.setOption(i)})}}}]);var Login=angular.module("Login",["ui.router","ngCookies"]);Login.controller("Login.Controller.Main",["$rootScope","$cookies","$scope","$state","Login.Service.Http",function(e,t,a,n,r){a.Login={},a.Login.submit=function(o){if(a.loginSubmitted=!1,o){var i=a.Login.username,d=a.Login.password;r.login({username:i,password:d}).then(function(r){var o=r.data.body[0];e.User=o,t.put("User",JSON.stringify(o)),200==r.data.head.status?n.go("main.dashboard"):a.loginError=!0})}else a.loginSubmitted=!0}}]),Login.factory("Login.Service.Http",["$http","API",function(e,t){function a(t){return e.get(n+"/login",{params:t})}var n=t.path;return{login:a}}]);var Main=angular.module("Main",["ui.router","ngCookies"]);Main.controller("Main.Controller.Main",["$scope","$cookies",function(e,t){e.User=JSON.parse(t.get("User"))}]);var DataQuotaDetail=angular.module("DataQuotaDetail",["ui.router"]);DataQuotaDetail.controller("DataQuotaDetail.Controller.Main",["$scope","$state","DataQuotaDetail.Service.Http","$stateParams",function(e,t,a,n){a.getDataQuotaDetailByDepID(n).then(function(t){e.DataQuotaDetail=t.data.body[0]}),a.getDataQuotaExampleByDepID({dataquotaid:n.data_quota_id}).then(function(t){e.DataQuotaExample=t.data.body[0]})}]),DataQuotaDetail.factory("DataQuotaDetail.Service.Http",["$http","API",function(e,t){function a(t){return e.get(r+"/data_quota_detail",{params:t})}function n(t){return e.get(r+"/examples_detail",{params:t})}var r=t.path;return{getDataQuotaDetailByDepID:a,getDataQuotaExampleByDepID:n}}]);var DataQuotaList=angular.module("DataQuotaList",["ui.router"]);DataQuotaList.controller("DataQuotaList.Controller.Main",["$scope","$state","DataQuotaList.Service.Http","$stateParams",function(e,t,a,n){function r(t){a.getDataQuota(t).then(function(t){e.DataQuotas=t.data.body[0].results,e.DataQuotasTotal=t.data.body[0].count,e.Paging.totalItems=t.data.body[0].count})}function o(e){var t={};t=""===i.dep_name?l:_.assign(t,i,l),_.assign(t,e),r(t)}var i={quota_dep_id:n.quota_dep_id},d={dep_name:n.dep_name};e.currentDep=d.dep_name;var l={limit:10,skip:0};e.Paging={},e.Paging.currentPage=1,e.Paging.itemsPerPage=10,e.Paging.pageChanged=function(){var t={};_.assign(t,i,{limit:10,skip:10*(e.Paging.currentPage-1)}),r(t)},function(){var e={};e=""===i?l:_.assign(e,i,l),r(e)}(),e.Retrieval=function(){var t={},a={quotaname:e.TargetDataQuotaName};""===i?_.assign(t,l,a):_.assign(t,i,l,a),r(t)},e.DataQuotaApplyInfo=function(t){a.getDataQuotaApplyInfo({data_quota_id:t}).then(function(){alert("申请查看成功");var t={};_.assign(t,{limit:10,skip:10*(e.Paging.currentPage-1)}),r(t)})};var s=1,u=2,p=3;a.getSystemDictByCatagory({dict_category:p}).then(function(t){e.ShareLevels=t.data.body}),a.getSystemDictByCatagory({dict_category:s}).then(function(t){e.ShareFrequencys=t.data.body}),a.getSystemDictByCatagory({dict_category:u}).then(function(t){e.DataLevels=t.data.body});var m={};e.ShareLevelFilter=function(e){m.share_level=e,"ALL"===e?(delete m.share_level,o(m)):o(m)},e.ShareFrequencyFilter=function(e){m.share_frequency=e,"ALL"===e?(delete m.share_frequency,o(m)):o(m)},m.sys_dict_id=[],e.DataLevelFilter=function(e){"ALL"===e?(m.sys_dict_id=[],o(m)):(m.sys_dict_id.push(e),o(m))}}]),DataQuotaList.factory("DataQuotaList.Service.Http",["$http","API",function(e,t){function a(t){return e.get(o+"/sys_dict",{params:t})}function n(t){return e.get(o+"/data_quota/sys_dict",{params:t})}function r(t){return e.post(o+"/data_quota_apply_info",{data:t})}var o=t.path;return{getSystemDictByCatagory:a,getDataQuotaApplyInfo:r,getDataQuota:n}}]);var DataQuota=angular.module("DataQuota",["ui.router"]);DataQuota.controller("DataQuota.Controller.Main",["$scope","$state","DataQuota.Service.Http",function(e,t,a){e.treeOptions={nodeChildren:"nodes",dirSelectable:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},a.menu().then(function(t){200===t.data.head.status&&(e.list=t.data.body)})}]),DataQuota.factory("DataQuota.Service.Http",["$http","API",function(e,t){function a(t){return e.get(n+"/menu",{params:t})}var n=t.path;return{menu:a}}]);var Audit=angular.module("Department.Audit",["ui.router"]);Audit.controller("Department.Audit.Controller.Main",["$scope","$q","Department.Audit.Service.Http",function(e,t,a){function n(){e.auditPromise=a.getAuditList(r).then(function(t){e.auditList=t.data.body[0].results,e.Paging.totalItems=t.data.body[0].count})}e.DeptAudit={},e.Paging={},e.Paging.maxSize=5,e.Paging.itemsPerPage=10;var r={};r.limit=10,r.skip=0,e.Paging.pageChanged=function(){r.skip=(e.Paging.currentPage-1)*r.limit,n(r)},n(),e.searchDeptAuditByName=function(){r.quota_name=e.DeptAudit.quota_name_filter,r.limit=10,r.skip=0,n()}}]),Audit.controller("Department.Audit.Controller.info",["$scope","$state","$q","Department.Audit.Service.Http","$stateParams",function(e,t,a,n,r){e.TabExampShow=!0,e.Tab={},e.Tab.show={},e.Tab.show.auditInfo=!0,n.getQuotaDetail({data_quota_id:r.DATAQUOTAID}).then(function(t){e.AuditDetail=t.data.body[0],e.AuditDetail.applydepname=r.APPLYDEPNAME,e.AuditDetail.applytime=r.APPLYTIME,console.log(e.AuditDetail),n.getQuotaExamples({dataquotaid:r.DATAQUOTAID}).then(function(t){e.DataQuotaExamples=t.data.body[0],0==t.data.head.total?e.TabExampShow=!1:(e.DataTitle=e.DataQuotaExamples.file_content.title,e.DataColumn=e.DataQuotaExamples.file_content.column),n.getQuotaRequirement({dataquotaid:r.DATAQUOTAID}).then(function(t){e.QuotaReqDetail=t.data.body[0]})})}),e.tabSwitcher=function(t){switch(t){case"auditInfo":e.Tab.show={},e.Tab.show.auditInfo=!0;break;case"auditExampData":e.Tab.show={},e.Tab.show.auditExampData=!0;break;case"requirementInfo":e.Tab.show={},e.Tab.show.requirementInfo=!0;break;default:case 2:e.Tab={},e.Tab.auditInfo.show=!0}},e.submitAudit=function(){e.AuditInfo.ID=r.AUDITID,n.updateAuditDetail(e.AuditInfo).then(function(e){200==e.data.head.status?(alert("审核成功"),t.go("main.department.audit",{},{reload:!0})):alert("审核失败")})}}]),Audit.factory("Department.Audit.Service.Http",["$http","$q","API",function(e,t,a){function n(t){return e.get(l+"/opendata_quotalist",{params:t})}function r(t){return e.get(l+"/data_quota_detail",{params:t})}function o(t){return e.put(l+"/data_quota_apply_info",{data:t})}function i(t){return e.get(l+"/examples_detail",{params:t})}function d(t){return e.get(l+"/requiement_detail",{params:t})}var l=a.path;return{getAuditList:n,getQuotaDetail:r,updateAuditDetail:o,getQuotaExamples:i,getQuotaRequirement:d}}]);var DInventory=angular.module("Department.Inventory",["ui.router","ngCookies","cgBusy"]);DInventory.controller("Department.Inventory.Controller.Main",["$cookies","$scope","$q","Department.Inventory.Service.Http",function(e,t,a,n){function r(e){e.dep_name=i,t.promise=n.getDepartQuotaList(e).then(function(e){console.log(e);var a=_.replace("  Hi"," ","0");console.log(a),t.depQuotaList=e.data.body[0].results,t.Paging.totalItems=e.data.body[0].count})}var o=JSON.parse(e.get("User")),i=o.dep_id;t.DepartDataQuota={},t.Paging={},t.Paging.maxSize=5,t.Paging.itemsPerPage=10;var d={};d.limit=10,d.skip=0,t.Paging.pageChanged=function(){d.skip=(t.Paging.currentPage-1)*d.limit,r(d)},t.delay=0,t.minDuration=0,t.message="加载中...",t.backdrop=!0,t.promise=null,r(d),t.getShareLevelAll=function(){t.shareLvMainSelection=[],d.share_level=null,d.limit=10,d.skip=0,r(d)},t.shareLvMainSelection=[],t.getDataQuotaListBySl=function(e){var a=t.shareLvMainSelection.indexOf(e.id);a>-1?t.shareLvMainSelection=[]:t.shareLvMainSelection=e.id,d.share_level=t.shareLvMainSelection,d.limit=10,d.skip=0,r(d)},t.getShareFreqAll=function(){t.shareFreqSelection=[],d.share_frequency=null,d.limit=10,d.skip=0,r(d)},t.shareFreqSelection=[],t.getDataQuotaListBySF=function(e){var a=t.shareFreqSelection.indexOf(e.id);a>-1?t.shareFreqSelection=[]:t.shareFreqSelection=e.id,d.share_frequency=t.shareFreqSelection,d.limit=10,d.skip=0,r(d)},t.getSpatialAll=function(){t.areaMainSelection=[],d.sys_dict_id=null,d.limit=10,d.skip=0,r(d)},t.areaMainSelection=[],t.getDataQuotaListByAP=function(e){var a=t.areaMainSelection.indexOf(e.id);a>-1?t.areaMainSelection.splice(a,1):t.areaMainSelection.push(e.id),d.sys_dict_id=t.areaMainSelection,d.limit=10,d.skip=0,r(d)},t.searchDeptDataQuotaByName=function(){d.quota_name=t.DepartDataQuota.quota_name_filter,d.limit=10,d.skip=0,r(d)},t.deleteQuota=function(e,t){var a=e.target.checked;n.deleteDataQuota({id:t,delete_flag:a?"true":"false"}).then(function(e){200==e.data.head.status})}}]),DInventory.controller("Department.Inventory.Controller.detail",["$scope","$q","Department.Inventory.Service.Http","$stateParams","$state",function(e,t,a,n,r){console.log(n.ID),a.getQuotaDetail({data_quota_id:n.ID}).then(function(t){e.DataQuotaDetail=t.data.body[0],a.getQuotaExamples({dataquotaid:n.ID}).then(function(t){e.DataQuotaExamples=t.data.body[0],e.DataTitle=e.DataQuotaExamples.file_content.title,e.DataColumn=e.DataQuotaExamples.file_content.column,console.log(e.DataTitle),console.log(e.DataColumn)})})}]),DInventory.controller("Department.Inventory.Controller.publish",["$cookies","$scope","$state","$q","$uibModal","Department.Inventory.Service.Component","Department.Inventory.Service.Http",function(e,t,a,n,r,o,i){var d=4,l=6,s=5,u="250375bd-02f0-11e6-a52a-5cf9dd40ad7e",p="25098ff3-02f0-11e6-a52a-5cf9dd40ad7e",m="2515e9b5-02f0-11e6-a52a-5cf9dd40ad7e",c=JSON.parse(e.get("User")),f=c.dep_id;t.DEP_NAME=c.dep_name,t.DataQuota={},t.DataQuota.data_show_format_add="",t.DataQuota.data_store_type_add="",t.DataQuota.calculate_method="",t.DataQuota.linkman="",t.DataQuota.contact_phone="",t.DataQuota.file_name="",i.getDepartmentList().then(function(e){t.deptList=e.data.body;_.remove(t.deptList,function(e){return e.id==f})}),i.getSystemDictByCatagory({dict_category:d}).then(function(e){t.quotaTypeList=e.data.body}),i.getSystemDictByCatagory({dict_category:l}).then(function(e){t.dataShowFormatList=e.data.body}),i.getSystemDictByCatagory({dict_category:s}).then(function(e){t.secretFlagList=e.data.body}),t.close=function(e){a.go("main.department.inventory",{},{reload:!0})},t.addQuota=function(e){t.submitted=!1;var n={},r=[],d=[];if(e){console.log(t.dataLevelSelection),n.dataQuota=t.DataQuota,_(t.dataLevelSelection).forEach(function(e){var a={};a.dataQuotaId=t.DataQuota.quota_name,a.sys_dict_id=e,a.obj_type=1,r.push(a)});var l=_.map(t.outputDeptList,"id");_(l).forEach(function(e){var a={};a.dataQuotaId=t.DataQuota.quota_name,a.apply_dep=e,d.push(a)}),n.dataRelationConfig=r,n.dataQuotaApplyInfo=d,console.log(n),i.saveDataQuota(n).then(function(e){if(console.log(e.data),200==e.data.head.status){t.Modal={};o.popModal(t,"Department.Inventory.Controller.publish","","import-example-modal").result.then(function(t){a.go("main.department.inventory.upload",{ID:e.data.body[0].id},{reload:!0})})}else alert("保存失败")})}else t.submitted=!0},t.depShow=!1,t.showHideDeps=function(e){u==t.DataQuota.share_level?t.depShow=!0:t.depShow=!1},t.storeTypeOther=!1,t.storeTypeChange=function(){p==t.DataQuota.data_store_type?t.storeTypeOther=!0:t.storeTypeOther=!1},t.dataShowOther=!1,t.dataShowChange=function(){m==t.DataQuota.data_show_format?t.dataShowOther=!0:t.dataShowOther=!1},t.dataLevelSelection=[],t.toggleDataLevelSelection=function(e){var a=t.dataLevelSelection.indexOf(e.id);a>-1?t.dataLevelSelection.splice(a,1):t.dataLevelSelection.push(e.id)}}]),DInventory.controller("Department.Inventory.Controller.upload",["$scope","$q","Department.Inventory.Service.Http","$stateParams","$state","$sce",function(e,t,a,n,r,o){e.uploadPromise=null,e.htmlPopover=o.trustAsHtml("<table class='table table-hover table-striped '><thead><tr><th>序号</th><th>城市</th><th>GDP(亿元)</th><th>增长</th><th>地方公共财政收入(亿元)</th><th>增长</th><th>城镇登记失业率</th><th>农村居民人均纯收入(元)</th><th>增长</th></tr></thead><tbody><tr><td>1</td><td>成都</td><td>9000</td><td>8.54%</td><td>8000</td><td>7.51%</td><td>1.39</td><td>5678</td><td>3.40%</td></tr></tbody></table>"),e.uploadFile=function(){var t=e.myFile;return console.log("file is "),console.dir(t),t?void(e.uploadPromise=a.uploadFile(t,n.ID).then(function(e){200==e.data.head.status&&(alert("上传成功!"),r.go("main.department.inventory",{},{reload:!0}))})):void alert("您还未选择文件")},e.toIndex=function(){r.go("main.department.inventory",{},{
reload:!0})}}]),DInventory.factory("Department.Inventory.Service.Http",["$http","$q","API",function(e,t,a){function n(){return e.get(p+"/sys_dep")}function r(t){return e.get(p+"/data_quota",{params:t})}function o(t){return e.get(p+"/data_quota_detail",{params:t})}function i(t){return e.post(p+"/data_quota",{data:t})}function d(t){return e.get(p+"/sys_dict",{params:t})}function l(t){return e.get(p+"/examples_detail",{params:t})}function s(t,a){var n=new FormData,r=p+"/upload/excel?data_quota_id="+a;n.append("file",t);var o=e.post(r,n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}});return o}function u(t){return e.put(p+"/data_quota_delete_flag",{data:t})}var p=a.path;return{saveDataQuota:i,getDepartmentList:n,getDepartQuotaList:r,getQuotaDetail:o,getSystemDictByCatagory:d,uploadFile:s,getQuotaExamples:l,deleteDataQuota:u}}]),DInventory.service("Department.Inventory.Service.Component",["$uibModal","$state",function(e,t){function a(e,t){e.Alerts=[{type:t.type,message:t.message,timeout:1200}],e.CloseAlert=function(t){e.Alerts.splice(t,1)}}function n(a,n,r,o){var i=e.open({animation:!0,backdrop:"static",templateUrl:o+".html",controller:n,scope:a});return a.Modal.confirm=function(){i.close(a.Modal)},a.Modal.cancel=function(){i.dismiss(),setTimeout(function(){alert("保存成功！"),t.go("main.department.inventory",{},{reload:!0})},600)},i}return{popAlert:a,popModal:n}}]),DInventory.directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,a,n){var r=e(n.fileModel),o=r.assign;a.bind("change",function(){t.$apply(function(){o(t,a[0].files[0])})})}}}]);var Department=angular.module("Department",["ui.router"]);Department.controller("Department.Controller.Main",["$cookies","$scope","$q","Department.Service.Http","$sce","$state",function(e,t,a,n,r,o){function i(){t.depSelect.show=!1,t.followDeptList=t.parentObj.outputAllDeptList;var e=[];_(t.followDeptList).forEach(function(t){var a={};a.follow_dep_id=t.dep_id,e.push(a)}),n.followDepts({userdep:e}).then(function(e){})}function d(){f.audit_status=0,t.mainAuditPromise=n.getAuditList(f).then(function(e){t.toAuditList=e.data.body[0].results,t.auditTotal=e.data.body[0].count})}function l(){h.response_dep_id=u,console.log(h),t.mainReqPromise=n.getDepartmentRequirementList(h).then(function(e){t.requireToConfirmList=e.data.body[0].results,t.reqTotal=e.data.body[0].count})}var s=JSON.parse(e.get("User")),u=s.dep_id,p=1,m=2,c=3,f={};f.limit=10,f.skip=0;var h={};h.limit=10,h.skip=0,t.depSelect={},t.followDeptList=[],t.parentObj={},d(),l(),n.getSystemDictByCatagory({dict_category:p}).then(function(e){t.shareFrequencyList=e.data.body}),n.getSystemDictByCatagory({dict_category:c}).then(function(e){t.shareLevelList=e.data.body}),n.getSystemDictByCatagory({dict_category:m}).then(function(e){t.dataLevelList=e.data.body}),n.getDepDataQuotaTotal().then(function(e){t.Count=e.data.body[0]}),t.auditMore=function(){o.go("main.department.audit",{},{reload:!0})},t.reqMore=function(){o.go("main.department.requirement",{},{reload:!0})},t.closeFn=function(){i()},n.getFollowDepList().then(function(e){t.parentObj.outputAllDeptList=e.data.body,t.followDeptList=_.uniq(t.parentObj.outputAllDeptList),n.getDepartmentFollowList().then(function(e){t.parentObj.deptAllList=e.data.body,t.parentObj.outputDeptList=[],console.log(t.parentObj.deptAllList),console.log(t.parentObj.outputAllDeptList),_(t.parentObj.deptAllList).forEach(function(e){e.icon="<img  src=styles/images/bureau/"+e.dep_en_name+" />",_(t.parentObj.outputAllDeptList).forEach(function(a){e.dep_id==a.dep_id&&(e.ticked=!0,t.parentObj.outputDeptList.push(e))})}),console.log(t.parentObj.outputDeptList),t.$broadcast("someEvent",t.parentObj.outputDeptList)})}),t.openFn=function(){t.parentObj.outputAllDeptList=t.parentObj.outputDeptList,console.log(t.parentObj.outputAllDeptList)},t.followDep=function(){i()}}]),Department.factory("Department.Service.Http",["$http","$q","API",function(e,t,a){function n(){return e.get(u+"/follow_sys_dep")}function r(){return e.get(u+"/depquota/summary")}function o(t){return e.get(u+"/sys_dict",{params:t})}function i(t){return e.get(u+"/opendata_quotalist",{params:t})}function d(t){return e.get(u+"/data_requiement",{params:t})}function l(){return e.get(u+"/followed_user_dep")}function s(t){return e.post(u+"/user_dep_batch",{data:t})}var u=a.path;return{getSystemDictByCatagory:o,getAuditList:i,getDepartmentRequirementList:d,getDepartmentFollowList:n,getDepDataQuotaTotal:r,followDepts:s,getFollowDepList:l}}]);var DepartmentReq=angular.module("Department.Requirement",["ui.router"]);DepartmentReq.controller("Department.Requirement.Controller.Main",["$cookies","$scope","$stateParams","Department.Requirement.Service.Component","Department.Requirement.Service.Http",function(e,t,a,n,r){function o(){l.dep_id=d,t.reqPromise=r.getDepartmentRequirementList(l).then(function(e){t.requirementList=e.data.body[0].results,t.Paging.totalItems=e.data.body[0].count})}var i=JSON.parse(e.get("User")),d=i.dep_id;t.DeptRequirement={},t.Paging={},t.Paging.maxSize=5,t.Paging.itemsPerPage=10;var l={};l.limit=10,l.skip=0,t.Paging.pageChanged=function(){l.skip=(t.Paging.currentPage-1)*l.limit,o(l)},o(),t.dataLevelReqSelection=[],t.toggleDataLevelReqSelection=function(e){var a=t.dataLevelReqSelection.indexOf(e.id);a>-1?t.dataLevelReqSelection.splice(a,1):t.dataLevelReqSelection.push(e.id)},r.getDepartmentList().then(function(e){t.deptList=e.data.body;_.remove(t.deptList,function(e){return e.id==d})}),t.publishReq=function(){t.Modal={},t.Modal.DepRequirment={};var e={},a=[];t.reqParent={},n.popModal(t,"发布","add-req-modal").result.then(function(){_(t.dataLevelReqSelection).forEach(function(e){var n={};n.datarequiementId=t.Modal.DepRequirment.requiement_name,n.sys_dict_id=e,n.obj_type=2,a.push(n)});var n=_.map(t.reqParent.outputDeptList,"id");console.log(n),t.Modal.DepRequirment.response_dep_id=n[0],e.dataRequiement=t.Modal.DepRequirment,e.dataRelationConfig=a,r.publishRequirement(e).then(function(e){200==e.data.head.status?(alert("发布成功"),o()):alert("发布失败")})})},t.searchDeptReqByName=function(){l.requiement_name=t.DeptRequirement.req_name_filter,l.limit=10,l.skip=0,o()},t.deleteReqFlag=!1,t.deleteReq=function(e){t.deleteReqFlag=!t.deleteReqFlag,r.deleteRequirement({id:e,delete_flag:t.deleteReqFlag}).then(function(e){})}}]),DepartmentReq.controller("Department.Requirement.Controller.confirm",["$cookies","$scope","$stateParams","Department.Requirement.Service.Http","Department.Requirement.Service.Component",function(e,t,a,n,r){function o(){l.response_dep_id=d,t.reqConfirmPromise=n.getDepartmentRequirementList(l).then(function(e){t.requirementConfirmList=e.data.body[0].results,t.Paging.totalItems=e.data.body[0].count})}t.Modal={},t.DeptRequirementConfirm={};var i=JSON.parse(e.get("User")),d=i.dep_id;t.DeptRequirement={},t.Paging={},t.Paging.maxSize=5,t.Paging.itemsPerPage=10;var l={};l.limit=10,l.skip=0,t.Paging.pageChanged=function(){l.skip=(t.Paging.currentPage-1)*l.limit,o(l)},o(),t.searchDeptReqConfirmByName=function(){l.requiement_name=t.DeptRequirementConfirm.req_name_filter,l.limit=10,l.skip=0,o()},n.getDepartQuotaList({dep_name:d}).then(function(e){console.log(e),t.depQuotaReqList=e.data.body[0].results}),t.toConfirm=function(e){t.Modal.ReqDetail=e,t.Modal.ReqResponse={},console.log(t.depQuotaReqList.length),0==t.depQuotaReqList.length?(t.Modal.ReqResponse.data_quota_id="",t.errorMsg="本部门还未添加任何指标",t.dataQuotaIdNull=!0):t.Modal.ReqResponse.data_quota_id=t.depQuotaReqList[0].id,r.popModalConfirm(t,"","confirm-req-modal").result.then(function(){console.log(t.Modal.ReqResponse),t.Modal.ReqResponse.id=e.id,n.updateRequirement(t.Modal.ReqResponse).then(function(a){200==a.data.head.status?1==t.Modal.ReqResponse.status?n.saveReqResponse({requiement_id:e.id,data_quota_id:t.Modal.ReqResponse.data_quota_id}).then(function(e){200==e.data.head.status?(alert("保存成功！"),o()):(alert("保存失败！"),o())}):(alert("保存成功！"),o()):alert("保存失败")})})}}]),DepartmentReq.controller("Department.Requirement.Controller.detail",["$scope","$stateParams","Department.Requirement.Service.Http","Department.Requirement.Service.Component",function(e,t,a,n){a.getReqDetail({data_requiement_id:t.ID}).then(function(t){console.log(t.data.body[0]),e.ReqDetail=t.data.body[0]})}]),DepartmentReq.factory("Department.Requirement.Service.Http",["$http","API",function(e,t){function a(t){return e.get(p+"/data_requiement",{params:t})}function n(t){return e.post(p+"/data_requiement",{data:t})}function r(t){return e.put(p+"/data_requiement",{data:t})}function o(t){return e.post(p+"/data_requiement_response",{data:t})}function i(t){return e.get(p+"/data_quota",{params:t})}function d(t){return e.get(p+"/data_requiement_detail",{params:t})}function l(t){return e.get(p+"/requirement/requireResponseList",{params:t})}function s(){return e.get(p+"/sys_dep")}function u(t){return e.put(p+"/data_requiement_delete",{data:data})}var p=t.path;return{getDepartmentRequirementList:a,publishRequirement:n,getReqDetail:d,getResponseList:l,updateRequirement:r,saveReqResponse:o,getDepartQuotaList:i,getDepartmentList:s,deleteRequirement:u}}]),DepartmentReq.service("Department.Requirement.Service.Component",["$uibModal",function(e){function t(e,t){e.Alerts=[{type:t.type,message:t.message,timeout:1200}],e.CloseAlert=function(t){e.Alerts.splice(t,1)}}function a(t,a,n){t.Modal.type=a;var r=e.open({animation:!0,backdrop:"static",templateUrl:n+".html",scope:t,size:"lg"});return t.Modal.confirm=function(e){console.log(t),e&&r.close(t.Modal)},t.Modal.cancel=function(){r.dismiss()},r}function n(t,a,n){t.Modal.type=a;var r=e.open({animation:!0,backdrop:"static",templateUrl:n+".html",scope:t,size:"lg"});return t.Modal.confirm=function(e){console.log(t),e&&t.reqParent.outputDeptList.length>0?r.close(t.Modal):t.error=!0},t.Modal.cancel=function(){r.dismiss()},r}return{popAlert:t,popModal:n,popModalConfirm:a}}]);var DepartmentShare=angular.module("DepartmentShare",["ui.router"]);DepartmentShare.controller("DepartmentShare.Controller.Main",["$scope","DepartmentShare.Service.Http",function(e,t){function a(a){e.sharePromise=t.shareDataQuotaList(a).then(function(t){e.depShareList=t.data.body[0].results,e.Paging.totalItems=t.data.body[0].count})}e.DepartmentShare={},e.Paging={},e.Paging.maxSize=5,e.Paging.itemsPerPage=10;var n={};n.limit=10,n.skip=0,e.Paging.pageChanged=function(){n.skip=(e.Paging.currentPage-1)*n.limit,a(n)},a(n),e.getShareLevelAllForShare=function(){e.shareLvShareSelection=[],n.share_level=null,n.limit=10,n.skip=0,a(n)},e.shareLvShareSelection=[],e.getShareDataQuotaListBySl=function(t){var r=e.shareLvShareSelection.indexOf(t.id);r>-1?e.shareLvShareSelection=[]:e.shareLvShareSelection=t.id,n.share_level=e.shareLvShareSelection,n.limit=10,n.skip=0,a(n)},e.getDataLevelAllForShare=function(){e.dataLevelShareSelection=[],n.sys_dict_id=null,n.limit=10,n.skip=0,a(n)},e.dataLevelShareSelection=[],e.getShareDataQuotaListByAP=function(t){var r=e.dataLevelShareSelection.indexOf(t.id);r>-1?e.dataLevelShareSelection.splice(r,1):e.dataLevelShareSelection.push(t.id),n.sys_dict_id=e.dataLevelShareSelection,n.limit=10,n.skip=0,a(n)},e.searchShareDataQuotaByName=function(){n.quota_name=e.DepartmentShare.quota_name_filter,n.limit=10,n.skip=0,a(n)},e.followChange=function(e,a){var n=e.target.checked;console.log(n),n?t.followDepartment({follow_dep_id:a}).then(function(e){200==e.data.head.status}):t.cancelFollowDepartment({follow_dep_id:a}).then(function(e){200==e.data.head.status})}}]),DepartmentShare.controller("DepartmentShare.Controller.detail",["$scope","DepartmentShare.Service.Http","$stateParams",function(e,t,a){t.getQuotaDetail({data_quota_id:a.ID}).then(function(t){e.DataQuotaDetail=t.data.body[0]})}]),DepartmentShare.factory("DepartmentShare.Service.Http",["$http","API",function(e,t){function a(t){return e.get(i+"/sharedata_quotalist",{params:t})}function n(t){return e.get(i+"/data_quota_detail",{params:t})}function r(t){return e.post(i+"/user_dep",{data:t})}function o(t){return e["delete"](i+"/user_dep",{data:t})}var i=t.path;return{shareDataQuotaList:a,getQuotaDetail:n,followDepartment:r,cancelFollowDepartment:o}}]);var SystemUser=angular.module("Department.SystemUser",["ui.router"]);SystemUser.controller("Department.SystemUser.Controller.Main",["$scope","$q","Department.SystemUser.Service.Http","Department.SystemUser.Service.Component","$uibModal",function(e,t,a,n,r){function o(){a.getUserList().then(function(t){e.users=t.data.body,e.DepUserTotal=t.data.head.total})}e.Modal={},e.deptList=[],o(),e.addUserModal=function(){e.Modal={},e.sysUser={},n.popModal(e,"添加","add-user-modal").result.then(function(){a.saveUser(e.sysUser).then(function(e){200==e.data.head.status?(alert("添加成功"),o()):alert("添加失败")})})},e.searchUser=function(){var t=e.username;alert(t)},e.updateUser=function(t){t.DEP_NAME=null,e.sysUser=t,n.popModal(e,"修改","add-user-modal").result.then(function(){a.updateUser(e.sysUser).then(function(e){200==e.data.head.status?(alert("修改成功"),o()):alert("修改失败")})})},e.deleteUser=function(e){console.log(e);var t=confirm("确定要删除吗？");t&&a.deleteUser(e).then(function(e){console.log(e.data),200==e.data.head.status?(alert("删除成功"),o()):alert("删除失败！"),o()})}}]),SystemUser.factory("Department.SystemUser.Service.Http",["$http","$q","API",function(e,t,a){function n(){return e.get(s+"/user")}function r(t){return e.get(s+"/user",{params:t})}function o(t){return e.post(s+"/user",{data:t})}function i(){return e.get(s+"/dep/")}function d(t){return e.put(s+"/user/",{data:t})}function l(t){return e["delete"](s+"/user",{data:{ID:t.ID}})}var s=a.path;return{getUserList:n,saveUser:o,getDepartmentList:i,updateUser:d,deleteUser:l,getUser:r}}]),SystemUser.service("Department.SystemUser.Service.Component",["$uibModal",function(e){function t(e,t){e.Alerts=[{type:t.type,message:t.message,timeout:1200}],e.CloseAlert=function(t){e.Alerts.splice(t,1)}}function a(t,a,n){t.Modal.type=a;var r=e.open({animation:!0,backdrop:"static",templateUrl:n+".html",scope:t});return t.Modal.confirm=function(e){e&&r.close(t.Modal)},t.Modal.cancel=function(){r.dismiss()},r}return{popAlert:t,popModal:a}}]);
//# sourceMappingURL=app.min.js.map
